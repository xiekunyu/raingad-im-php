import{_ as e,u as t,s,m as a,aa as o,$ as i,y as n,N as l,ab as r,O as d,o as c,c as u,w as p,j as m,g,ac as h}from"./index-95127376.js";const v={judgeIosPermission:function(e){return"location"==e?(s=plus.ios.import("CLLocationManager"),t=2!=s.authorizationStatus(),console.log("定位权限开启："+t),plus.ios.deleteObject(s),t):"camera"==e?function(){var e=!1,t=plus.ios.import("AVCaptureDevice"),s=t.authorizationStatusForMediaType("vide");return console.log("authStatus:"+s),3==s?(e=!0,console.log("相机权限已经开启")):console.log("相机权限没有开启"),plus.ios.deleteObject(t),e}():"photoLibrary"==e?function(){var e=!1,t=plus.ios.import("PHPhotoLibrary"),s=t.authorizationStatus();return console.log("authStatus:"+s),3==s?(e=!0,console.log("相册权限已经开启")):console.log("相册权限没有开启"),plus.ios.deleteObject(t),e}():"record"==e?function(){var e=!1,t=plus.ios.import("AVAudioSession"),s=t.sharedInstance().recordPermission();return console.log("permissionStatus:"+s),1684369017==s||1970168948==s?console.log("麦克风权限没有开启"):(e=!0,console.log("麦克风权限已经开启")),plus.ios.deleteObject(t),e}():"push"==e?function(){var e=!1,t=plus.ios.import("UIApplication"),s=t.sharedApplication(),a=0;if(s.currentUserNotificationSettings){var o=s.currentUserNotificationSettings();a=o.plusGetAttribute("types"),console.log("enabledTypes1:"+a),0==a?console.log("推送权限没有开启"):(e=!0,console.log("已经开启推送功能!")),plus.ios.deleteObject(o)}else 0==(a=s.enabledRemoteNotificationTypes())?console.log("推送权限没有开启!"):(e=!0,console.log("已经开启推送功能!")),console.log("enabledTypes2:"+a);return plus.ios.deleteObject(s),plus.ios.deleteObject(t),e}():"contact"==e?function(){var e=!1,t=plus.ios.import("CNContactStore");return 3==t.authorizationStatusForEntityType(0)?(e=!0,console.log("通讯录权限已经开启")):console.log("通讯录权限没有开启"),plus.ios.deleteObject(t),e}():"calendar"==e?function(){var e=!1,t=plus.ios.import("EKEventStore");return 3==t.authorizationStatusForEntityType(0)?(e=!0,console.log("日历权限已经开启")):console.log("日历权限没有开启"),plus.ios.deleteObject(t),e}():"memo"==e&&function(){var e=!1,t=plus.ios.import("EKEventStore");return 3==t.authorizationStatusForEntityType(1)?(e=!0,console.log("备忘录权限已经开启")):console.log("备忘录权限没有开启"),plus.ios.deleteObject(t),e}();var t,s},requestAndroidPermission:function(e){return new Promise(((t,s)=>{plus.android.requestPermissions([e],(function(e){for(var s=0,a=0;a<e.granted.length;a++){var o=e.granted[a];console.log("已获取的权限："+o),s=1}for(a=0;a<e.deniedPresent.length;a++){var i=e.deniedPresent[a];console.log("拒绝本次申请的权限："+i),s=0}for(a=0;a<e.deniedAlways.length;a++){var n=e.deniedAlways[a];console.log("永久拒绝申请的权限："+n),s=-1}t(s)}),(function(e){console.log("申请权限错误："+e.code+" = "+e.message),t({code:e.code,message:e.message})}))}))},checkSystemEnableLocation:function(){var e=plus.android.importClass("android.content.Context"),t=plus.android.importClass("android.location.LocationManager"),s=plus.android.runtimeMainActivity().getSystemService(e.LOCATION_SERVICE).isProviderEnabled(t.GPS_PROVIDER);return console.log("系统定位开启:"+s),s},gotoAppPermissionSetting:function(){var e=plus.android.importClass("android.content.Intent"),t=plus.android.importClass("android.provider.Settings"),s=plus.android.importClass("android.net.Uri"),a=plus.android.runtimeMainActivity(),o=new e;o.setAction(t.ACTION_APPLICATION_DETAILS_SETTINGS);var i=s.fromParts("package",a.getPackageName(),null);o.setData(i),a.startActivity(o)}},y=t(s),{userInfo:C}=a(y);const f=e({data:()=>({html:"",postMsg:null,webview:null,Frames:null,mainFrame:null,contact:null,type:!1,wsData:null,msg_id:null}),onReady(){},onLoad:function(e){let t="h5";t="h5",this.html="/hybrid/html/index.html?id="+C.value.user_id+"&status="+e.status+"&name="+e.name+"&target_id="+e.id+"&type="+e.type+"&platform=h5&avatar="+e.avatar,this.msg_id=e.msg_id,this.type=e.type,this.status=e.status,this.contact={id:e.id,displayName:e.name,avatar:e.avatar},setTimeout((()=>{this.Frames=document.getElementsByTagName("iframe"),this.mainFrame=this.Frames[0].contentWindow,this.postMsg=this.h5sendH5}),500),window.onmessage=e=>{this.msgCallback(e)},o("webrtcConn"),i("webrtcConn",(e=>{this.msg_id==e.msg_id?(this.wsData=e,this.postMsg(JSON.parse(JSON.stringify(e.extends)),"*")):this.$api.msgApi.sendToMsg({toContactId:e.fromUser.user_id,type:e.extends.type,event:"busy",status:e.extends.status,code:907,id:e.id,msg_id:e.msg_id})}))},methods:{async checkAuth(e){},async requestPermission(e){let t="";"record"==e?t="android.permission.RECORD_AUDIO":"camera"==e&&(t="android.permission.CAMERA");return 1==await v.requestAndroidPermission(t)||this.closeCall()},message(e){const t={data:e.detail.data[0]};this.msgCallback(t)},appsendH5(e){e.iceCandidate&&e.iceCandidate.length>0&&(e.iceCandidate=JSON.parse(e.iceCandidate)),this.webview.evalJS("getUniAppMessage('"+JSON.stringify(e)+"')")},h5sendH5(e){this.mainFrame.postMessage(e,"*")},msgCallback(e){let t="",s="";this.wsData&&(s=this.wsData.id??"");let a=!0;switch(e.data.event){case"hangup":this.closeCall(),907==e.data.code&&n({title:"对方忙~~",icon:"none"}),e.data.isbtn||(a=!1);break;case"iceCandidate":console.log("监听同步ice");let s={};s.candidate=e.data.iceCandidate.candidate,s.sdpMLineIndex=e.data.iceCandidate.sdpMLineIndex,s.sdpMid=e.data.iceCandidate.sdpMid,t=JSON.stringify(s);break;case"mediaDevices":a=!1,n({title:"请检查音视频",icon:"none"}),this.closeCall()}a&&this.$api.msgApi.sendToMsg({id:s,msg_id:this.msg_id,toContactId:this.contact.id,type:this.type,event:e.data.event,status:e.data.status??"",code:e.data.code??"",callTime:e.data.callTime??"",sdp:e.data.sdp??"",iceCandidate:t})},closeCall(){l().length>1?r():d({url:"/pages/index/index"})}}},[["render",function(e,t,s,a,o,i){const n=h,l=m;return c(),u(l,{class:""},{default:p((()=>[g(n,{onMessage:i.message,src:o.html},null,8,["onMessage","src"])])),_:1})}],["__scopeId","data-v-c0ef98a1"]]);export{f as default};
