import{_ as e,J as s,m as a,p as t,o as l,c as r,w as u,i,f as o,h as c,n as d,b as n,d as m,F as g,g as h,t as f,e as _,r as p,j as y,I as k}from"./index-118ee3a3.js";const U=s("userInfo");const b=e({data:()=>({keywords:"",group_id:"",modelName:"",userList:[],allUser:[],isAdmin:!1,isManage:!1,isAuth:!1,userInfo:U,curUser:{}}),watch:{keywords(e){""==e?this.userList=this.allUser:this.search()}},onLoad(e){this.group_id=e.group_id?e.group_id:"",this.getGroupuserlist()},methods:{getGroupuserlist(){this.userList=[],this.$api.msgApi.groupUserList({group_id:this.group_id}).then((e=>{const s=e.data.filter((e=>1==e.role&&e.userInfo.id==U.user_id));s.length&&(this.isAdmin=!0);const a=e.data.filter((e=>2==e.role&&e.userInfo.id==U.user_id));a.length&&(this.manage=!0),(s.length||a.length)&&(this.isAuth=!0);const t=e.data;t.forEach((e=>{e.realname=e.userInfo.displayName,e.name_py=e.userInfo.name_py})),this.allUser=t,this.userList=e.data}))},openModel(e){e.realname=e.userInfo.displayName,e.avatar=e.userInfo.avatar,this.curUser=e,this.modelName="userOpt"},setManage(){const e=2==this.curUser.role?3:2;this.$api.msgApi.setManager({id:this.group_id,user_id:this.curUser.user_id,role:e}).then((e=>{0==e.code&&this.getGroupuserlist(),this.modelName=""}))},removeUser(){this.modelName="",a({title:"确定要删除该成员吗?",success:e=>{e.confirm&&this.$api.msgApi.removeUser({id:this.group_id,user_id:this.curUser.user_id}).then((e=>{0==e.code&&this.getGroupuserlist()}))}})},search(){const e=JSON.parse(JSON.stringify(this.allUser));this.userList=this.$util.searchObject(e,["realname","name_py"],this.keywords)},openChatDetail(e){U.user_id!=e.user_id&&t({url:"/pages/contacts/detail?id="+e.user_id})}}},[["render",function(e,s,a,t,U,b){const x=p("cu-custom"),I=y,v=k,C=i,N=p("Empty");return l(),r(C,null,{default:u((()=>[o(x,{bgColor:"bg-gradual-green",isBack:!0},{backText:u((()=>[])),content:u((()=>[c("群成员")])),_:1}),o(C,{class:"cu-bar bg-white search fixed",style:d([{top:e.CustomBar+"px"}])},{default:u((()=>[o(C,{class:"search-form round"},{default:u((()=>[o(I,{class:"cuIcon-search"}),o(v,{type:"text",modelValue:U.keywords,"onUpdate:modelValue":s[0]||(s[0]=e=>U.keywords=e),placeholder:"输入搜索的关键词","confirm-type":"search"},null,8,["modelValue"])])),_:1})])),_:1},8,["style"]),o(C,{style:{"margin-top":"104rpx"}},{default:u((()=>[o(C,{class:"cu-list menu-avatar"},{default:u((()=>[(l(!0),n(g,null,m(U.userList,(e=>(l(),r(C,{class:"cu-item"},{default:u((()=>[o(C,{class:"cu-avatar round lg",style:d("background-image:url("+e.userInfo.avatar+");"),onClick:s=>b.openChatDetail(e)},null,8,["style","onClick"]),o(C,{class:"content"},{default:u((()=>[o(C,{class:"text-grey"},{default:u((()=>[o(C,{class:"text-cut"},{default:u((()=>[c(f(e.userInfo.displayName),1)])),_:2},1024),e.role<3?(l(),r(C,{key:0,class:_(["cu-tag round sm",1==e.role?"bg-red":"bg-orange"])},{default:u((()=>[c(f(1==e.role?"群主":2==e.role?"管理员":""),1)])),_:2},1032,["class"])):h("",!0),e.user_id==U.userInfo.user_id?(l(),r(C,{key:1,class:"cu-tag round sm"},{default:u((()=>[c("我")])),_:1})):h("",!0)])),_:2},1024)])),_:2},1024),o(C,{class:"action",onClick:s=>b.openModel(e)},{default:u((()=>[o(C,{class:"text-grey text-sm"},{default:u((()=>[e.role>1&&U.isAuth?(l(),r(I,{key:0,class:"cuIcon-more f-24"})):h("",!0)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),256)),U.userList.length?h("",!0):(l(),r(N,{key:0,noDatatext:"未搜索到数据",textcolor:"#999"}))])),_:1})])),_:1}),o(C,{class:_(["cu-modal bottom-modal","userOpt"==U.modelName?"show":""])},{default:u((()=>[o(C,{class:"cu-dialog"},{default:u((()=>[o(C,{class:"manage-content"},{default:u((()=>[o(C,{class:"cu-list menu bg-white"},{default:u((()=>[U.curUser?(l(),r(C,{key:0,class:"cu-item"},{default:u((()=>[o(C,{class:"content im-flex im-justify-content-center im-align-items-center"},{default:u((()=>[o(C,{class:"cu-avatar round sm",style:d("background-image:url("+U.curUser.avatar+");")},null,8,["style"]),o(C,{class:"text-cut ml-5"},{default:u((()=>[c(f(U.curUser.realname),1)])),_:1}),2==U.curUser.role?(l(),r(C,{key:0,class:"cu-tag round sm bg-orange"},{default:u((()=>[c("管理员")])),_:1})):h("",!0)])),_:1})])),_:1})):h("",!0),U.isAdmin?(l(),r(C,{key:1,class:"cu-item",onClick:s[1]||(s[1]=e=>b.setManage())},{default:u((()=>[o(C,{class:"content padding-tb-sm"},{default:u((()=>[o(I,null,{default:u((()=>[c(f(2==U.curUser.role?"取消管理员":"设为管理员"),1)])),_:1})])),_:1})])),_:1})):h("",!0),o(C,{class:"cu-item",onClick:s[2]||(s[2]=e=>b.removeUser())},{default:u((()=>[o(C,{class:"content padding-tb-sm"},{default:u((()=>[o(I,null,{default:u((()=>[c("移出群聊")])),_:1})])),_:1})])),_:1}),o(C,{class:"parting-line-5"}),o(C,{class:"cu-item",onClick:s[3]||(s[3]=e=>U.modelName="")},{default:u((()=>[o(C,{class:"content padding-tb-sm"},{default:u((()=>[o(I,{class:"c-red"},{default:u((()=>[c("取消")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-e37cb163"]]);export{b as default};
