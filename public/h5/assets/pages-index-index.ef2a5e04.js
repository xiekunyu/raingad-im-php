import{u as t,s as a,a as e,b as s,_ as l,$ as c,c as n,d as i,e as o,h as u,n as d,o as r,f as m,w as g,g as f,i as p,j as _,k as h,l as b,r as x,F as C,m as y,p as k,q as I,t as v,v as T,x as w,y as S,z as j,A as P,B as N,C as M,D as L}from"./index-bcce18ca.js";import{e as A,_ as B}from"./emoji.e230eca0.js";import{r as W}from"./uni-app.es.7a55a698.js";import{s as q}from"./status.ca9f180e.js";import D from"./pages-contacts-index.50bce740.js";import{s as $}from"./scan.5a01e36e.js";const F=t(a),{contacts:X}=e(F),E=s(a),{multiport:z}=e(E);const Q=l({components:{statusPoint:q},data:()=>({navCurrent:0,msgs:X,mainHeight:500,pageLoading:!0,multiport:z,socketStatus:!0,damping:.29,moveIndex:-1,x:0,oX:0,scY:!0,btnWidthpx:160,touchStart:!1,modalName:null,listTouchStart:0,listTouchDirection:null,emojiMap:[],chatStatus:!0,paddingB:0,appSetting:E.appSetting,globalConfig:E.globalConfig}),computed:{msgsIn(){return this.msgs.filter((t=>t.lastContent))}},mounted(){this.moveIndex=-1,c("socketStatus",(t=>{t||(this.multiport=!1),this.socketStatus=t}))},created:function(){this.btnWidthpx=-1*n(this.btnWidth)+2;let t=[];A.forEach((function(a){let e=a.children;e.length>0&&e.forEach((function(a){let e=a.name,s=a.src;t[e]=s}))})),this.emojiMap=t,this.paddingB=this.inlineTools},methods:{btnTap:function(t,a){0==t?(a.is_top=0==a.is_top?1:0,this.$api.msgApi.setChatTopAPI({id:a.id,is_top:a.is_top,is_group:a.is_group}).then((t=>{0==t.code&&F.updateContacts(a)}))):1==t?i({title:"确定要删除吗?",success:t=>{t.confirm&&this.$api.msgApi.delChatAPI({id:a.id,is_group:a.is_group}).then((t=>{0==t.code&&F.deleteContacts(a)}))}}):2==t&&(a.is_notice=0==a.is_notice?1:0,this.$api.msgApi.setIsNotice({id:a.id,is_notice:a.is_notice,is_group:a.is_group}).then((t=>{0==t.code&&F.updateContacts(a)})))},reconnect(){o({title:"重连中..."}),this.socketIo.connectSocketInit({type:"ping"}),setTimeout((()=>{u()}),1500)},emojiToHtml(t){if(!t)return;let a=this.emojiMap;return t.replace(/\[!(\w+)\]/gi,(function(t,e){var s=e;return a[s]?'<img class=\'mr-5\' style="width:18px;height:18px" emoji-name="'.concat(e,'" src="').concat(a[s],'" />'):"[!".concat(e,"]")}))},ListTouchStart(t){this.listTouchStart=t.touches[0].pageX},ListTouchMove(t){let a=t.touches[0].pageX-this.listTouchStart;Math.abs(a)>100&&a<0?this.listTouchDirection="left":this.listTouchDirection="right"},ListTouchEnd(t){"left"==this.listTouchDirection?(this.modalName=t.currentTarget.dataset.target,this.chatStatus=!1):this.modalName=null,this.listTouchDirection=null},openChat(t,a){this.chatStatus?d({url:"/pages/message/chat?id="+a.id,animationType:"slide-in-right"}):this.chatStatus=!0},from_time(t){return this.$util.timeFormat(t)}}},[["render",function(t,a,e,s,l,c){const n=y,i=k("statusPoint"),o=w,u=W(I("mp-html"),B),d=k("Empty");return r(),m(n,null,{default:g((()=>[l.socketStatus?_("",!0):(r(),m(n,{key:0,class:"socket-status pd-10 im-flex justify-between im-align-items-center"},{default:g((()=>[f(n,{class:"cuIcon-infofill text-red f-18"}),f(n,{class:"c-666 f-12"},{default:g((()=>[p(" WS通信已断开，检查网络设置是否正常")])),_:1}),f(n,{onClick:a[0]||(a[0]=t=>c.reconnect())},{default:g((()=>[p("重连")])),_:1})])),_:1})),l.multiport?(r(),m(n,{key:1,class:"border-b pd-10 text-gray im-flex im-justify-content-start"},{default:g((()=>[f(n,{class:"iconfont icon-web f-18 ml-20"}),f(n,{class:"f-12 ml-20"},{default:g((()=>[p(" Web网页端已登录")])),_:1})])),_:1})):_("",!0),f(n,{class:"im-message-list"},{default:g((()=>[c.msgsIn.length>0?(r(),m(n,{key:0,class:"cu-list menu-avatar",style:h({paddingBottom:l.paddingB+"px"})},{default:g((()=>[(r(!0),b(C,null,x(c.msgsIn,((t,a)=>(r(),m(n,{class:v(["cu-item",[l.modalName=="move-box-"+a?"move-cur":"",1==t.is_top?"top-contacts":"",0==t.is_group?"third":"second"]]),key:a,onTouchstart:c.ListTouchStart,onTouchmove:c.ListTouchMove,onTouchend:c.ListTouchEnd,onClick:e=>c.openChat(a,t),"data-target":"move-box-"+a},{default:g((()=>[f(n,{class:v(["cu-avatar lg",l.appSetting.circleAvatar?"round":"radius"]),style:h([{backgroundImage:"url("+t.avatar+")"}])},null,8,["class","style"]),f(n,{class:"content"},{default:g((()=>[f(n,{class:"c-333"},{default:g((()=>[t.is_online&&0==t.is_group&&1==l.globalConfig.chatInfo.online?(r(),m(i,{key:0,type:"success"})):_("",!0),f(n,{class:"text-overflow f-16",style:{width:"80%"}},{default:g((()=>[p(T(t.displayName),1)])),_:2},1024)])),_:2},1024),f(n,{class:"im-flex im-justify-content-start im-align-items-start pt-5",style:{height:"50rpx",overflow:"hidden"}},{default:g((()=>[f(n,{class:"text-gray text-sm"},{default:g((()=>[t.unread>0&&0==t.is_notice?(r(),m(o,{key:0},{default:g((()=>[p("["+T(t.unread)+"条未读] ",1)])),_:2},1024)):_("",!0)])),_:2},1024),f(u,{content:c.emojiToHtml(t.lastContent),class:"im-flex text-gray text-sm text-overflow no-click"},null,8,["content"])])),_:2},1024)])),_:2},1024),f(n,{class:"action"},{default:g((()=>[f(n,{class:"text-grey text-xs"},{default:g((()=>[p(T(c.from_time(t.lastSendTime)),1)])),_:2},1024),t.unread>0&&t.is_notice?(r(),m(n,{key:0,class:"cu-tag round bg-red sm"},{default:g((()=>[p(T(t.unread),1)])),_:2},1024)):_("",!0),0==t.is_notice?(r(),m(n,{key:1,class:"c-999"},{default:g((()=>[f(o,{class:"cuIcon-musicforbidfill"})])),_:1})):_("",!0)])),_:2},1024),f(n,{class:v(["move",0==t.is_group?"third":"second"])},{default:g((()=>[1==t.is_top?(r(),m(n,{key:0,class:"bg-grey",onClick:a=>c.btnTap(0,t)},{default:g((()=>[p("取消置顶")])),_:2},1032,["onClick"])):(r(),m(n,{key:1,class:"bg-blue",onClick:a=>c.btnTap(0,t)},{default:g((()=>[p("置顶聊天")])),_:2},1032,["onClick"])),1==t.is_notice?(r(),m(n,{key:2,class:"bg-orange",onClick:a=>c.btnTap(2,t)},{default:g((()=>[p("免扰")])),_:2},1032,["onClick"])):(r(),m(n,{key:3,class:"bg-orange",onClick:a=>c.btnTap(2,t)},{default:g((()=>[p("取消免扰")])),_:2},1032,["onClick"])),0==t.is_group?(r(),m(n,{key:4,class:"bg-red",onClick:a=>c.btnTap(1,t)},{default:g((()=>[p("删除会话")])),_:2},1032,["onClick"])):_("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","onTouchstart","onTouchmove","onTouchend","onClick","data-target"])))),128))])),_:1},8,["style"])):(r(),m(d,{key:1,noDatatext:"暂无聊天",textcolor:"#999"}))])),_:1})])),_:1})}],["__scopeId","data-v-2de9a399"]]),H=""+new URL("user-card-bg-ba5b09d7.jpg",import.meta.url).href,U=s();const V=l({data:()=>({isCard:!0,userInfo:U.userInfo,paddingB:0}),created:function(){this.paddingB=this.inlineTools},methods:{IsCard(t){this.isCard=t.detail.value}}},[["render",function(t,a,e,s,l,c){const n=S,i=y,o=w;return r(),m(i,{style:h({paddingBottom:l.paddingB+"px"})},{default:g((()=>[f(i,{class:"im-friend-header"},{default:g((()=>[f(i,{class:"im-friend-bg"},{default:g((()=>[f(n,{class:"im-friend-image",src:H,mode:"widthFix"})])),_:1}),f(i,{class:"im-user im-flex im-justify-content-start align-center"},{default:g((()=>[f(o,{class:"text-white mr-5"},{default:g((()=>[p(T(l.userInfo.realname),1)])),_:1}),f(n,{class:"radius-10",style:{width:"120rpx",height:"120rpx"},src:l.userInfo.avatar,mode:"widthFix"},null,8,["src"])])),_:1})])),_:1}),f(i,{class:"m-10 text-center"},{default:g((()=>[p("此页面是静态模板！")])),_:1}),f(i,{class:"cu-card dynamic no-card"},{default:g((()=>[f(i,{class:"cu-item shadow"},{default:g((()=>[f(i,{class:"cu-list menu-avatar"},{default:g((()=>[f(i,{class:"cu-item"},{default:g((()=>[f(i,{class:"cu-avatar round lg",style:{"background-image":"url(https://api.multiavatar.com/raingad3.png?apikey=zdvXV3W4MjwhP9)"}}),f(i,{class:"content flex-sub"},{default:g((()=>[f(i,null,{default:g((()=>[p("凯尔")])),_:1}),f(i,{class:"text-gray text-sm flex justify-between"},{default:g((()=>[p(" 2019年12月3日 ")])),_:1})])),_:1})])),_:1})])),_:1}),f(i,{class:"text-content"},{default:g((()=>[p(" 折磨生出苦难，苦难又会加剧折磨，凡间这无穷的循环，将有我来终结！ ")])),_:1}),f(i,{class:v(["grid flex-sub padding-lr",l.isCard?"col-3 grid-square":"col-1"])},{default:g((()=>[(r(!0),b(C,null,x(l.isCard?9:1,((t,a)=>(r(),m(i,{class:v(["bg-img",l.isCard?"":"only-img"]),style:{"background-image":"url(https://ossweb-img.qq.com/images/lol/web201310/skin/big10006.jpg)"},key:a},null,8,["class"])))),128))])),_:1},8,["class"]),f(i,{class:"text-gray text-sm text-right padding"},{default:g((()=>[f(o,{class:"cuIcon-attentionfill margin-lr-xs"}),p(" 10 "),f(o,{class:"cuIcon-appreciatefill margin-lr-xs"}),p(" 20 "),f(o,{class:"cuIcon-messagefill margin-lr-xs"}),p(" 30 ")])),_:1}),f(i,{class:"cu-list menu-avatar comment solids-top"},{default:g((()=>[f(i,{class:"cu-item"},{default:g((()=>[f(i,{class:"cu-avatar round",style:{"background-image":"url(https://api.multiavatar.com/raingad5.png?apikey=zdvXV3W4MjwhP9)"}}),f(i,{class:"content"},{default:g((()=>[f(i,{class:"text-grey"},{default:g((()=>[p("莫甘娜")])),_:1}),f(i,{class:"text-gray text-content text-df"},{default:g((()=>[p(" 凯尔，你被自己的光芒变的盲目。 ")])),_:1}),f(i,{class:"bg-grey padding-sm radius margin-top-sm text-sm"},{default:g((()=>[f(i,{class:"flex"},{default:g((()=>[f(i,null,{default:g((()=>[p("凯尔：")])),_:1}),f(i,{class:"flex-sub"},{default:g((()=>[p("妹妹，你在帮他们给黑暗找借口吗?")])),_:1})])),_:1})])),_:1}),f(i,{class:"margin-top-sm flex justify-between"},{default:g((()=>[f(i,{class:"text-gray text-df"},{default:g((()=>[p("2018年12月4日")])),_:1}),f(i,null,{default:g((()=>[f(o,{class:"cuIcon-appreciatefill text-red"}),f(o,{class:"cuIcon-messagefill text-gray margin-left-sm"})])),_:1})])),_:1})])),_:1})])),_:1}),f(i,{class:"cu-item"},{default:g((()=>[f(i,{class:"cu-avatar round",style:{"background-image":"url(https://api.multiavatar.com/raingad2.png?apikey=zdvXV3W4MjwhP9)"}}),f(i,{class:"content"},{default:g((()=>[f(i,{class:"text-grey"},{default:g((()=>[p("凯尔")])),_:1}),f(i,{class:"text-gray text-content text-df"},{default:g((()=>[p(" 妹妹，如果不是为了飞翔，我们要这翅膀有什么用? ")])),_:1}),f(i,{class:"bg-grey padding-sm radius margin-top-sm text-sm"},{default:g((()=>[f(i,{class:"flex"},{default:g((()=>[f(i,null,{default:g((()=>[p("莫甘娜：")])),_:1}),f(i,{class:"flex-sub"},{default:g((()=>[p("如果不能立足于大地，要这双脚又有何用?")])),_:1})])),_:1})])),_:1}),f(i,{class:"margin-top-sm flex justify-between"},{default:g((()=>[f(i,{class:"text-gray text-df"},{default:g((()=>[p("2018年12月4日")])),_:1}),f(i,null,{default:g((()=>[f(o,{class:"cuIcon-appreciate text-gray"}),f(o,{class:"cuIcon-messagefill text-gray margin-left-sm"})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])}],["__scopeId","data-v-f6597acf"]]),G=s(a);const R=l({data:()=>({loginStore:G,globalConfig:G.globalConfig,appSetting:G.appSetting}),onShow(){},methods:{logout(){let t=j("client_id");this.$api.LoginApi.logout({client_id:t}).then((t=>{0==t.code&&G.logout()}))},about(){if(this.globalConfig&&this.globalConfig.demon_mode){d({url:"/pages/mine/webview?src="+"https://im.raingad.com"})}else d({url:"/pages/mine/about"})},showSetting(){d({url:"/pages/mine/setting"})},showsecure(){d({url:"/pages/mine/secure"})},editInfo(){d({url:"/pages/mine/profile"})},scan(){$.scanQr()},openQr(){d({url:"/pages/index/qrcode"})}}},[["render",function(t,a,e,s,l,c){const n=y,i=w,o=P;return r(),m(n,null,{default:g((()=>[f(n,{class:"padding flex im-space-between im-align-items-center bg-white mb-10"},{default:g((()=>[f(n,{class:"flex justify-start bg-white",onClick:a[0]||(a[0]=t=>c.editInfo())},{default:g((()=>[f(n,{class:v(["cu-avatar lg mr-15",l.appSetting.circleAvatar?"round":"radius"]),style:h([{backgroundImage:"url("+l.loginStore.userInfo.avatar+")"}])},null,8,["class","style"]),f(n,{class:"im-flex im-justify-content-start im-columns"},{default:g((()=>[f(n,{class:"mb-5 f-18 mb-10 im-flex im-align-items-center"},{default:g((()=>[f(n,{class:"c-333"},{default:g((()=>[p(T(l.loginStore.userInfo.realname),1)])),_:1}),f(n,{class:v(["cu-tag ml-10 round light",l.loginStore.userInfo.is_auth?"bg-orange":"bg-grey"])},{default:g((()=>[p(T(l.loginStore.userInfo.is_auth?"已认证":"未认证"),1)])),_:1},8,["class"])])),_:1}),f(n,{class:"text-gray mb-10"},{default:g((()=>[p(T(l.loginStore.userInfo.account),1)])),_:1})])),_:1})])),_:1}),f(n,{class:"cuIcon-qrcode f-24 text-gray",onClick:c.openQr},null,8,["onClick"])])),_:1}),f(n,{class:"cu-list menu"},{default:g((()=>[f(n,{class:"cu-item",onClick:c.scan},{default:g((()=>[f(n,{class:"content"},{default:g((()=>[f(i,{class:"cuIcon-scan text-blue"}),f(i,null,{default:g((()=>[p("扫一扫")])),_:1})])),_:1}),f(n,{class:"action"},{default:g((()=>[f(i,{class:"text-grey cuIcon-right"})])),_:1})])),_:1},8,["onClick"]),f(n,{class:"cu-item",onClick:c.showSetting},{default:g((()=>[f(n,{class:"content"},{default:g((()=>[f(i,{class:"cuIcon-settings text-grey"}),f(i,null,{default:g((()=>[p("通用设置")])),_:1})])),_:1}),f(n,{class:"action"},{default:g((()=>[f(i,{class:"text-grey cuIcon-right"})])),_:1})])),_:1},8,["onClick"]),f(n,{class:"cu-item",onClick:c.showsecure},{default:g((()=>[f(n,{class:"content"},{default:g((()=>[f(i,{class:"cuIcon-safe text-orange"}),f(i,null,{default:g((()=>[p("账号安全")])),_:1})])),_:1}),f(n,{class:"action"},{default:g((()=>[f(i,{class:"text-grey cuIcon-right"})])),_:1})])),_:1},8,["onClick"]),l.globalConfig.demon_mode?(r(),m(n,{key:0,class:"cu-item",onClick:a[1]||(a[1]=t=>c.about())},{default:g((()=>[f(n,{class:"content"},{default:g((()=>[f(i,{class:"cuIcon-info text-green"}),f(i,null,{default:g((()=>[p("关于IM")])),_:1})])),_:1}),f(n,{class:"action"},{default:g((()=>[f(i,{class:"text-grey cuIcon-right"})])),_:1})])),_:1})):_("",!0)])),_:1}),f(n,{class:"padding flex flex-direction"},{default:g((()=>[f(o,{class:"cu-btn bg-red lg",onClick:a[2]||(a[2]=t=>c.logout())},{default:g((()=>[p("退出登录")])),_:1})])),_:1})])),_:1})}]]),Y=t(a),J=s(a),{unread:K,sysUnread:O}=e(Y);const Z=l({components:{message:Q,contacts:D,compass:V,mine:R},data(){let t=[{name:"message",title:"消息",notice:K},{name:"contacts",title:"通讯录",notice:O}],a={name:"compass",title:"探索",notice:0};J.globalConfig&&J.globalConfig.demon_mode&&t.push(a);return t.push({name:"mine",title:"我的",notice:0}),{globalConfig:J.globalConfig,PageCur:"message",PageName:"消息",TabCur:0,modelName:!1,navList:t}},mounted(){N(),this.initContacts(),c("socketStatus",(t=>{t&&(console.log("触发了一次"),this.initContacts())}))},methods:{closeModel(){this.modelName=!1},scan(){$.scanQr()},NavChange:function(t){this.PageCur=t.name,this.PageName=t.title},showContacts(){1==this.TabCur?this.TabCur=0:this.TabCur=1},initContacts(){this.modelName="",this.$api.msgApi.initContacts().then((t=>{Y.sysUnread=t.count,Y.initContacts(t.data)}))},addGroup(){d({url:"/pages/index/userSelection?type=1"})},addFriend(){d({url:"/pages/contacts/search"})},search(){const t="message"==this.PageCur?1:2;d({url:"/pages/index/search?type="+t})}}},[["render",function(t,a,e,s,l,c){const n=w,i=y,o=k("cu-custom"),u=k("message"),d=k("contacts"),h=k("compass"),I=k("mine"),j=S;return r(),m(i,null,{default:g((()=>[f(o,{bgColor:"bg-white"},{backText:g((()=>["message"==l.PageCur||"contacts"==l.PageCur?(r(),m(i,{key:0,class:"f-20 ml-10 mr-10",onClick:a[0]||(a[0]=t=>c.search())},{default:g((()=>[f(n,{class:"cuIcon-search",style:{"margin-left":"-10px"}})])),_:1})):_("",!0)])),content:g((()=>[p(T(l.PageName),1)])),right:g((()=>["contacts"==l.PageCur&&l.globalConfig&&l.globalConfig.demon_mode?(r(),m(i,{key:0,class:"f-20 ml-10 mr-10",onClick:a[1]||(a[1]=t=>c.showContacts())},{default:g((()=>[f(n,{class:v(["f-24",l.TabCur?"cuIcon-peoplelist":"cuIcon-friend"])},null,8,["class"])])),_:1})):_("",!0),"message"==l.PageCur?(r(),m(i,{key:1,class:"f-20 ml-10 mr-10",onClick:a[2]||(a[2]=t=>l.modelName="add")},{default:g((()=>[f(n,{class:"cuIcon-add f-28"})])),_:1})):_("",!0)])),_:1}),f(i,null,{default:g((()=>[M(f(u,null,null,512),[[L,"message"==l.PageCur]]),M(f(d,{TabCur:l.TabCur},null,8,["TabCur"]),[[L,"contacts"==l.PageCur]]),M(f(h,null,null,512),[[L,"compass"==l.PageCur]]),M(f(I,null,null,512),[[L,"mine"==l.PageCur]])])),_:1}),f(i,{class:"cu-bar tabbar bg-white shadow foot"},{default:g((()=>[(r(!0),b(C,null,x(l.navList,((t,a)=>(r(),m(i,{class:"action",onClick:a=>c.NavChange(t),key:a,"data-cur":"message"},{default:g((()=>[f(i,{class:"cuIcon-cu-image"},{default:g((()=>[f(j,{src:"/static/image/tabbar/"+[t.name]+[l.PageCur==t.name?"-active":""]+".svg"},null,8,["src"]),t.notice>0?(r(),m(i,{key:0,class:"cu-tag badge"},{default:g((()=>[p(T(t.notice),1)])),_:2},1024)):_("",!0)])),_:2},1024),f(i,{class:v(l.PageCur==t.name?"text-green":"text-black")},{default:g((()=>[p(T(t.title),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1}),f(i,{class:v(["cu-modal bottom-modal","add"==l.modelName?"show":""]),onClick:a[8]||(a[8]=t=>l.modelName="")},{default:g((()=>[f(i,{class:"cu-dialog"},{default:g((()=>[f(i,{class:"manage-content"},{default:g((()=>[f(i,{class:"cu-list menu bg-white"},{default:g((()=>[f(i,{class:"cu-item",onClick:a[3]||(a[3]=t=>{c.initContacts()})},{default:g((()=>[f(i,{class:"content padding-tb-sm"},{default:g((()=>[f(n,{class:"cuIcon-refresh"}),f(n,null,{default:g((()=>[p("更新消息列表")])),_:1})])),_:1})])),_:1}),2==l.globalConfig.sysInfo.runMode?(r(),m(i,{key:0,class:"cu-item",onClick:a[4]||(a[4]=t=>c.addFriend())},{default:g((()=>[f(i,{class:"content padding-tb-sm"},{default:g((()=>[f(n,{class:"cuIcon-friendadd"}),f(n,null,{default:g((()=>[p("添加朋友")])),_:1})])),_:1})])),_:1})):_("",!0),f(i,{class:"cu-item",onClick:a[5]||(a[5]=t=>c.addGroup())},{default:g((()=>[f(i,{class:"content padding-tb-sm"},{default:g((()=>[f(n,{class:"cuIcon-friend"}),f(n,null,{default:g((()=>[p("创建群聊")])),_:1})])),_:1})])),_:1}),f(i,{class:"cu-item",onClick:a[6]||(a[6]=t=>c.scan())},{default:g((()=>[f(i,{class:"content padding-tb-sm"},{default:g((()=>[f(n,{class:"cuIcon-scan mr-10"}),f(n,null,{default:g((()=>[p("扫 一 扫")])),_:1})])),_:1})])),_:1}),f(i,{class:"parting-line-5"}),f(i,{class:"cu-item",onClick:a[7]||(a[7]=t=>l.modelName="")},{default:g((()=>[f(i,{class:"content padding-tb-sm"},{default:g((()=>[f(n,{class:"c-red"},{default:g((()=>[p("取消")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}]]);export{Z as default};
