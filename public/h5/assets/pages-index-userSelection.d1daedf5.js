import{ai as e,_ as t,b as s,o as a,c as l,w as i,i as o,t as c,d as r,F as d,f as n,e as h,n as u,g as m,h as g,k as p,j as f,aj as y,ak as _,al as x,aa as b,a9 as k,l as v,s as U,m as C,G as L,ag as S,Q as D,z as T,p as $,v as w,x as V,q as I,r as A,N,S as E,y as B}from"./index-4f38998e.js";import{_ as M}from"./uni-load-more.aead9146.js";import{r as F}from"./uni-app.es.5429cc53.js";const R=t({name:"uniDataChecklist",mixins:[e.mixinDatacom||{}],emits:["input","update:modelValue","change"],props:{mode:{type:String,default:"default"},multiple:{type:Boolean,default:!1},value:{type:[Array,String,Number],default:()=>""},modelValue:{type:[Array,String,Number],default:()=>""},localdata:{type:Array,default:()=>[]},min:{type:[Number,String],default:""},max:{type:[Number,String],default:""},wrap:{type:Boolean,default:!1},icon:{type:String,default:"left"},selectedColor:{type:String,default:""},selectedTextColor:{type:String,default:""},emptyText:{type:String,default:"暂无数据"},disabled:{type:Boolean,default:!1},map:{type:Object,default:()=>({text:"text",value:"value"})}},watch:{localdata:{handler(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},deep:!0},mixinDatacomResData(e){this.range=e,this.dataList=this.getDataList(this.getSelectedValue(e))},value(e){this.dataList=this.getDataList(e)},modelValue(e){this.dataList=this.getDataList(e)}},data:()=>({dataList:[],range:[],contentText:{contentdown:"查看更多",contentrefresh:"加载中",contentnomore:"没有更多"},isLocal:!0,styles:{selectedColor:"#2979ff",selectedTextColor:"#666"},isTop:0}),computed:{dataValue(){return""===this.value?this.modelValue:(this.modelValue,this.value)}},created(){this.localdata&&0!==this.localdata.length?(this.isLocal=!0,this.range=this.localdata,this.dataList=this.getDataList(this.getSelectedValue(this.range))):this.collection&&(this.isLocal=!1,this.loadData())},methods:{loadData(){this.mixinDatacomGet().then((e=>{this.mixinDatacomResData=e.result.data,0===this.mixinDatacomResData.length?(this.isLocal=!1,this.mixinDatacomErrorMessage=this.emptyText):this.isLocal=!0})).catch((e=>{this.mixinDatacomErrorMessage=e.message}))},getForm(e="uniForms"){let t=this.$parent,s=t.$options.name;for(;s!==e;){if(t=t.$parent,!t)return!1;s=t.$options.name}return t},chagne(e){const t=e.detail.value;let s={value:[],data:[]};if(this.multiple)this.range.forEach((e=>{t.includes(e[this.map.value]+"")&&(s.value.push(e[this.map.value]),s.data.push(e))}));else{const e=this.range.find((e=>e[this.map.value]+""===t));e&&(s={value:e[this.map.value],data:e})}this.$emit("input",s.value),this.$emit("update:modelValue",s.value),this.$emit("change",{detail:s}),this.multiple?this.dataList=this.getDataList(s.value,!0):this.dataList=this.getDataList(s.value)},getDataList(e){let t=JSON.parse(JSON.stringify(this.range)),s=[];return this.multiple&&(Array.isArray(e)||(e=[])),t.forEach(((t,a)=>{if(t.disabled=t.disable||t.disabled||!1,this.multiple)if(e.length>0){let s=e.find((e=>e===t[this.map.value]));t.selected=void 0!==s}else t.selected=!1;else t.selected=e===t[this.map.value];s.push(t)})),this.setRange(s)},setRange(e){let t=e.filter((e=>e.selected)),s=Number(this.min)||0,a=Number(this.max)||"";return e.forEach(((l,i)=>{if(this.multiple){if(t.length<=s){void 0!==t.find((e=>e[this.map.value]===l[this.map.value]))&&(l.disabled=!0)}if(t.length>=a&&""!==a){void 0===t.find((e=>e[this.map.value]===l[this.map.value]))&&(l.disabled=!0)}}this.setStyles(l,i),e[i]=l})),e},setStyles(e,t){e.styleBackgroud=this.setStyleBackgroud(e),e.styleIcon=this.setStyleIcon(e),e.styleIconText=this.setStyleIconText(e),e.styleRightIcon=this.setStyleRightIcon(e)},getSelectedValue(e){if(!this.multiple)return this.dataValue;let t=[];return e.forEach((e=>{e.selected&&t.push(e[this.map.value])})),this.dataValue.length>0?this.dataValue:t},setStyleBackgroud(e){let t={},s=this.selectedColor?this.selectedColor:"#2979ff";"list"!==this.mode&&(t["border-color"]=e.selected?s:"#DCDFE6"),"tag"===this.mode&&(t["background-color"]=e.selected?s:"#f5f5f5");let a="";for(let l in t)a+=`${l}:${t[l]};`;return a},setStyleIcon(e){let t={},s="",a=this.selectedColor?this.selectedColor:"#2979ff";t["background-color"]=e.selected?a:"#fff",t["border-color"]=e.selected?a:"#DCDFE6",!e.selected&&e.disabled&&(t["background-color"]="#F2F6FC",t["border-color"]=e.selected?a:"#DCDFE6");for(let l in t)s+=`${l}:${t[l]};`;return s},setStyleIconText(e){let t={},s="",a=this.selectedColor?this.selectedColor:"#2979ff";"tag"===this.mode?t.color=e.selected?this.selectedTextColor?this.selectedTextColor:"#fff":"#666":t.color=e.selected?this.selectedTextColor?this.selectedTextColor:a:"#666",!e.selected&&e.disabled&&(t.color="#999");for(let l in t)s+=`${l}:${t[l]};`;return s},setStyleRightIcon(e){let t={},s="";"list"===this.mode&&(t["border-color"]=e.selected?this.styles.selectedColor:"#DCDFE6");for(let a in t)s+=`${a}:${t[a]};`;return s}}},[["render",function(e,t,v,U,C,L){const S=F(s("uni-load-more"),M),D=p,T=f,$=y,w=_,V=x,I=b,A=k;return a(),l(T,{class:"uni-data-checklist",style:u({"margin-top":C.isTop+"px"})},{default:i((()=>[C.isLocal?(a(),r(d,{key:1},[v.multiple?(a(),l(V,{key:0,class:n(["checklist-group",{"is-list":"list"===v.mode||v.wrap}]),onChange:L.chagne},{default:i((()=>[(a(!0),r(d,null,h(C.dataList,((e,t)=>(a(),l(w,{class:n(["checklist-box",["is--"+v.mode,e.selected?"is-checked":"",v.disabled||e.disabled?"is-disable":"",0!==t&&"list"===v.mode?"is-list-border":""]]),style:u(e.styleBackgroud),key:t},{default:i((()=>[m($,{class:"hidden",hidden:"",disabled:v.disabled||!!e.disabled,value:e[v.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==v.mode&&"list"!==v.mode||"list"===v.mode&&"left"===v.icon?(a(),l(T,{key:0,class:"checkbox__inner",style:u(e.styleIcon)},{default:i((()=>[m(T,{class:"checkbox__inner-icon"})])),_:2},1032,["style"])):g("",!0),m(T,{class:n(["checklist-content",{"list-content":"list"===v.mode&&"left"===v.icon}])},{default:i((()=>[m(D,{class:"checklist-text",style:u(e.styleIconText)},{default:i((()=>[o(c(e[v.map.text]),1)])),_:2},1032,["style"]),"list"===v.mode&&"right"===v.icon?(a(),l(T,{key:0,class:"checkobx__list",style:u(e.styleBackgroud)},null,8,["style"])):g("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"])):(a(),l(A,{key:1,class:n(["checklist-group",{"is-list":"list"===v.mode,"is-wrap":v.wrap}]),onChange:L.chagne},{default:i((()=>[(a(!0),r(d,null,h(C.dataList,((e,t)=>(a(),l(w,{class:n(["checklist-box",["is--"+v.mode,e.selected?"is-checked":"",v.disabled||e.disabled?"is-disable":"",0!==t&&"list"===v.mode?"is-list-border":""]]),style:u(e.styleBackgroud),key:t},{default:i((()=>[m(I,{class:"hidden",hidden:"",disabled:v.disabled||e.disabled,value:e[v.map.value]+"",checked:e.selected},null,8,["disabled","value","checked"]),"tag"!==v.mode&&"list"!==v.mode||"list"===v.mode&&"left"===v.icon?(a(),l(T,{key:0,class:"radio__inner",style:u(e.styleBackgroud)},{default:i((()=>[m(T,{class:"radio__inner-icon",style:u(e.styleIcon)},null,8,["style"])])),_:2},1032,["style"])):g("",!0),m(T,{class:n(["checklist-content",{"list-content":"list"===v.mode&&"left"===v.icon}])},{default:i((()=>[m(D,{class:"checklist-text",style:u(e.styleIconText)},{default:i((()=>[o(c(e[v.map.text]),1)])),_:2},1032,["style"]),"list"===v.mode&&"right"===v.icon?(a(),l(T,{key:0,style:u(e.styleRightIcon),class:"checkobx__list"},null,8,["style"])):g("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","style"])))),128))])),_:1},8,["class","onChange"]))],64)):(a(),l(T,{key:0,class:"uni-data-loading"},{default:i((()=>[e.mixinDatacomErrorMessage?(a(),l(D,{key:1},{default:i((()=>[o(c(e.mixinDatacomErrorMessage),1)])),_:1})):(a(),l(S,{key:0,status:"loading",iconType:"snow",iconSize:18,"content-text":C.contentText},null,8,["content-text"]))])),_:1}))])),_:1},8,["style"])}],["__scopeId","data-v-cb752505"]]),j=v(U);C(j);const G=t({data:()=>({title:"发起群聊",contact_id:"",lists:[],keywords:"",searchList:[],selectUser:[],userList:[],changeUser:[],user_ids:[],type:1,relayState:!1,scrollLeft:300,contacList:[],searcheUser:[],curMsg:{}}),watch:{relayState(e){1==e&&(L({icon:"success",title:"转发成功"}),setTimeout((()=>{S()}),2e3))},keywords(e){this.search(),""!=e&&(this.searcheUser=this.changeUser)},searcheUser(e){const t=this.changeUser.concat(e);this.changeUser=[...new Set(t)]}},components:{},onLoad(e){var t=D(),s=t[t.length-2];this.type=e.type?e.type:1,this.contact_id=e.contact_id?e.contact_id:"",2==e.type?(this.title="添加成员",this.user_ids=s.user_ids,this.getAllUser()):3==e.type?(this.title="转发聊天",this.curMsg=s.curMsg,this.getAllUser()):(this.title="发起群聊",this.getAllUser())},methods:{relay(){let e=this.changeUser.map((e=>e.id));if(e.length)if(e.length>5)L({title:"转发的人数不能超过5人！",icon:"none"});else{var t=D(),s=t[t.length-2];let a="";a=s.fromUser,s.contact.id;let l="";l="relayCrm"==this.type||"relayProject"==this.type?s.message:T("selectedItem"),e.forEach((e=>{let t={id:this.$util.getUuid(),is_group:0,fromUser:a,extends:l.extends?l.extends:"",type:l.type,toContactId:e,content:l.content,sendTime:(new Date).getTime()};this.$api.msgApi.sendMessage(t).then((e=>{200===e.code&&(this.relayState=!0)}))}))}else L({title:"请选择至少一名人员",icon:"none"})},delUser(){$({title:"提示",content:"确定删除？",cancelText:"取消",confirmText:"确认",showCancel:!0,success:e=>{if(e.confirm){var t=D();let e=t[t.length-2].group_id;this.$api.msgApi.removeUser({user_id:this.changeUser.user_id,id:e}).then((e=>{200===e.code&&S()}))}else console.log("cancel")}})},addGroupUser(e){var t=D(),s=t[t.length-2];s.getsimpleMessage=!1;let a=s.group_id;this.$api.msgApi.addGroupUser({user_ids:e,id:a}).then((e=>{200==e.code&&S()}))},addGroup(e){this.$api.msgApi.addGroup({user_ids:e}).then((e=>{200==e.code&&setTimeout((()=>{S()}),2e3)}))},getAllUser(){const e=T("allContacts");let t=[];3==this.type?(t=e.filter((e=>e.id!=this.contact_id)),t.forEach((e=>{e.disable=!1;let t=e.displayName;e.is_group&&(t+="（群聊）"),e.text=t,e.value=e.id}))):(t=e.filter((e=>0==e.is_group)),this.contacList=JSON.parse(JSON.stringify(t)),t.forEach((e=>{e.disable=!1,e.text=e.displayName,e.value=e.id,this.user_ids.length&&2==this.type&&this.user_ids.includes(e.id)&&(e.disable=!0)})),1==this.type&&this.contact_id&&(this.changeUser.push(parseInt(this.contact_id)),this.selectUser=t.filter((e=>e.id==this.contact_id)))),this.userList=t,this.lists=t},chooseUser(e){this.selectUser=e.detail.data,setTimeout((()=>{this.scrollLeft+=300}),50)},chooseSearchUser(e){this.selectUser=this.$util.mergeArrays(e.detail.data,this.selectUser),setTimeout((()=>{this.scrollLeft+=300}),50)},removeUser(e){this.selectUser=this.selectUser.filter((t=>t.id!=e)),this.changeUser=this.changeUser.filter((t=>t!=e))},save(){if(w({title:"保存中...",mask:!0}),!this.changeUser.length)return L({title:"请选择人员",icon:"none"});if(1==this.type)this.$api.msgApi.addGroup({user_ids:this.changeUser}).then((e=>{V();const t=e.data;j.appendContacts(t),I({url:"/pages/message/chat?id="+t.id})}));else if(2==this.type)this.$api.msgApi.addGroupUser({user_ids:this.changeUser,id:this.contact_id}).then((e=>{V(),S()}));else if(3==this.type){if(this.changeUser.length>5)return L({title:"单次转发不能超过5人",icon:"none"});this.$api.msgApi.forwardMessage({user_ids:this.changeUser,msg_id:this.curMsg.msg_id}).then((e=>{V(),S()}))}else this.$api.msgApi.removeUser({user_ids:this.changeUser,id:this.contact_id}).then((e=>{V(),S()}))},search:function(e){let t=JSON.parse(JSON.stringify(this.lists));this.searchList=this.$util.searchObject(t,["displayName","name_py"],this.keywords)},confirm:function(e){let t=[];e&&(this.userList.filter((s=>{let a=s.realname?s.realname:s.userInfo.displayName;return a.includes(e.trim())&&t.push(s),a.includes(e.trim())})),this.lists=t)}}},[["render",function(e,t,n,y,_,x){const b=f,k=A("cu-custom"),v=p,U=N,C=F(s("uni-data-checkbox"),R),L=A("Empty"),S=B,D=E;return a(),l(b,null,{default:i((()=>[m(k,{bgColor:"bg-gradual-green",isBack:!0},{backText:i((()=>[])),content:i((()=>[o(c(_.title),1)])),right:i((()=>[m(b,{class:"mr-10 f-16",onClick:x.save},{default:i((()=>[o(c(3==_.type?"转发":"保存"),1)])),_:1},8,["onClick"])])),_:1}),m(b,{class:"cu-bar bg-white search fixed",style:u([{top:e.CustomBar+"px"}])},{default:i((()=>[m(b,{class:"search-form round"},{default:i((()=>[m(v,{class:"cuIcon-search"}),m(U,{type:"text",modelValue:_.keywords,"onUpdate:modelValue":t[0]||(t[0]=e=>_.keywords=e),placeholder:"输入搜索的关键词","confirm-type":"search"},null,8,["modelValue"])])),_:1})])),_:1},8,["style"]),_.keywords?g("",!0):(a(),l(b,{key:0,class:"gui-padding",style:{"margin-top":"120rpx","padding-bottom":"100rpx"}},{default:i((()=>[m(C,{multiple:"",class:"user-list-select",onChange:x.chooseUser,modelValue:_.changeUser,"onUpdate:modelValue":t[1]||(t[1]=e=>_.changeUser=e),localdata:_.lists},null,8,["onChange","modelValue","localdata"]),_.lists.length?g("",!0):(a(),l(L,{key:0,noDatatext:"无联系人",textcolor:"#999"}))])),_:1})),_.keywords?(a(),l(b,{key:1,class:"gui-padding",style:{"margin-top":"120rpx","padding-bottom":"100rpx"}},{default:i((()=>[m(C,{multiple:"",class:"user-list-select",onChange:x.chooseSearchUser,modelValue:_.searcheUser,"onUpdate:modelValue":t[2]||(t[2]=e=>_.searcheUser=e),localdata:_.searchList},null,8,["onChange","modelValue","localdata"]),_.searchList.length?g("",!0):(a(),l(L,{key:0,noDatatext:"未搜索到数据",textcolor:"#999"}))])),_:1})):g("",!0),m(b,{class:"cu-bar bg-white tabbar border shop footer-opt"},{default:i((()=>[m(D,{class:"scroll-view_H","scroll-x":"true","scroll-anchoring":!0,"scroll-left":_.scrollLeft},{default:i((()=>[m(b,{class:"user-list-avatar"},{default:i((()=>[(a(!0),r(d,null,h(_.selectUser,(e=>(a(),l(S,{class:"user-avatar",src:e.avatar,onClick:t=>x.removeUser(e.id)},null,8,["src","onClick"])))),256))])),_:1}),m(b,{class:"select-num pd-10"},{default:i((()=>[o("已选"+c(_.selectUser.length)+"人",1)])),_:1})])),_:1},8,["scroll-left"])])),_:1})])),_:1})}],["__scopeId","data-v-b59b1c44"]]);export{G as default};
