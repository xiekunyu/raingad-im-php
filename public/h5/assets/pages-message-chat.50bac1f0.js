import{_ as e,o as t,c as s,j as i,B as o,y as a,C as n,D as c,E as l,q as r,p as d,w as u,g as m,f as h,h as p,G as g,i as f,t as y,n as x,d as _,e as k,F as w,H as b,I,J as C,b as v,z as T,S as M,v as B,x as S,K as U,l as j,s as L,m as R,u as H,L as E,a as $,M as F,$ as N,N as D,O as P,P as O,Q as z,r as A,k as V,R as J}from"./index-95127376.js";import{_ as q}from"./uni-load-more.8da79595.js";import{r as G}from"./uni-app.es.e962dbb2.js";import{e as K,s as Q,_ as W}from"./status.bb90e777.js";const Y=e({data:()=>({isUserMedia:!1,stream:null,audio:null,recorder:null,chunks:[],startTime:0}),mounted(){if(-1===origin.indexOf("https")&&-1===origin.indexOf("localhost")&&-1===origin.indexOf("127.0.0.1"))throw this.$emit("error","100"),"请在 https 环境中使用本插件。";if(!navigator.mediaDevices||!window.MediaRecorder)throw this.$emit("error","101"),"当前浏览器不支持";this.getRecorderManager()},methods:{getRecorderManager(){this.audio=document.createElement("audio"),navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{this.isUserMedia=!0,e.getTracks().forEach((e=>{e.stop()}))})).catch((e=>{this.onErrorHandler(e)}))},start(){if(!this.isUserMedia)return console.log("设备不支持");navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{this.startTime=(new Date).getTime(),this.stream=e,this.recorder=new MediaRecorder(e),this.recorder.ondataavailable=this.getRecordingData,this.recorder.onstop=this.saveRecordingData,this.recorder.start()})).catch((e=>{this.onErrorHandler(e)}))},stop(){this.recorder.stop(),this.stream.getTracks().forEach((e=>{e.stop()}))},getRecordingData(e){this.chunks.push(e.data)},saveRecordingData(){const e=new Blob(this.chunks,{type:"audio/mpeg"}),t=URL.createObjectURL(e);this.chunks=[];let s=((new Date).getTime()-this.startTime).toString().split("");s.splice(s.length-2),s.splice(s.length-1,0,"."),s=parseFloat(s.join(""));const i={data:e,duration:s,localUrl:t};this.$emit("success",i)},onErrorHandler(e){if(console.log(e),"NotAllowedError"===e.name)throw this.$emit("error","201"),"用户拒绝了当前的浏览器实例的访问请求";if("NotReadableError"===e.name)throw this.$emit("error","101"),"当前浏览器不支持";throw this.$emit("error","500"),"调用失败，原因不详"}},destroyed(){this.stop()}},[["render",function(e,o,a,n,c,l){const r=i;return t(),s(r,{class:"recorder"})}]]);const X=e({name:"im-input",components:{MumuRecorder:Y},props:{boxStatus:{type:Number,default:0},contact:{type:Object,default:{}}},data:()=>({InputBottom:0,paddingB:0,footerHeight:50,boxHeight:300,uploading:!1,recShow:!1,inputMsg:"",recorderManager:null,recing:!1,recLength:1,recTimer:null,tmpVoice:"",isUseRecorder:!1,playItemIndex:-1,currentAudio:"",mainHeight:0,isCancel:!1,isH5:!1,isApp:!1,appBox:0,TabCur:0,scrollLeft:0,emojiList:[],currentEmojiList:[],isFocus:!1}),watch:{boxStatus(e){this.appBox=0,this.InputBottom=0},appBox(e){0!=e||this.isFocus||(this.InputBottom=0)},InputBottom(e){this.$emit("setPad",e)}},created:function(){this.emojiList=K,this.currentEmojiList=K[0].children,o({success:e=>{let t=e.windowHeight;this.mainHeight=t}}),this.isH5=!0},methods:{chooseEmoji(e){let t="[!"+e.name+"]";this.inputMsg+=t},tabSelect(e){this.TabCur=e.currentTarget.dataset.id,this.scrollLeft=60*(e.currentTarget.dataset.id-1),this.currentEmojiList=this.emojiList[this.TabCur].children},showAppBox(e){this.appBox==e?(this.appBox=0,this.InputBottom=0):(this.appBox=e,this.InputBottom=this.boxHeight,this.recShow=!1)},showRec:function(){this.InputBottom=0,this.appBox=0,1==this.recShow?this.recShow=!1:this.recShow=!0},sendVoiceMsg:function(){if(""==this.tmpVoice)return void a({title:"录制已取消",icon:"none"});let e={localUrl:this.tmpVoice,duration:this.recLength};this.handlerSuccess(e),this.tmpVoice="",this.recLength=0},sendTextMsg:function(){if(1!=this.appBox&&(this.isFocus=!0),""==this.inputMsg)return!1;let e={type:"text",content:this.inputMsg};this.inputMsg="",this.$emit("send",e,"")},chooseImg:function(){let e=this,t={type:"image",status:"going"};n({count:9,sizeType:["compressed"],sourceType:["album","camera"],success:s=>{s.tempFiles.forEach((function(s){t.content=s.path,t.fileName=s.name,t.fileSize=s.size,e.$emit("send",t,s.path)}))}})},chooseVideo:function(){let e=this,t={type:"video",status:"going"};c({sourceType:["camera","album"],success:function(s){if(s.duration>60)return a({title:"视频长度不能超过60秒",icon:"error"});const i=s.tempFilePath;let o={duration:s.duration,width:s.width,height:s.height};t.fileName=s.name,t.fileSize=s.size,t.extends=o,t.content=i,e.$emit("send",t,i)}})},chooseFile:function(){let e=this;l({count:5,success:function(t){e.appendFile(t)}})},appendFile(e){let t=this;e.tempFiles.forEach((function(e){let s={type:"file",status:"going",fileName:e.name,fileSize:e.size,content:e.path},i=e.type;-1!=i.indexOf("image/")&&(s.type="image"),-1!=i.indexOf("video/")&&(s.type="video"),s.content=e.path,t.$emit("send",s,e.path)}))},chooseProject:()=>a({title:"自己扩展呗~~"}),calling(e){let t=this.$util.getUuid();r({url:"/pages/message/call?msg_id="+t+"&type="+e+"&status=1&id="+this.contact.id+"&name="+this.contact.displayName+"&avatar="+encodeURI(this.contact.avatar)})},InputFocus(e){this.isFocus=!0,this.appBox>0&&(this.appBox=0),this.InputBottom=0},InputBlur(e){this.appBox||this.isFocus||(this.InputBottom=0),this.isFocus=!1},startRecorder(){console.log("录音开始..."),this.$refs.recorderRef.start(),this.isUseRecorder=!0},endRecorder(){console.log("录音结束"),this.$refs.recorderRef.stop(),this.isUseRecorder=!1},cancelRecorder(){this.endRecorder(),this.isCancel=!0},moveRecorder(e){e.touches[0].clientY<this.mainHeight-80?this.isCancel=!0:this.isCancel=!1},handlerSuccess(e){if(this.checkRecorder(e.duration),this.isCancel)return this.isCancel=!1,console.log("录音已取消");let t={type:"voice",content:e.localUrl,fileName:this.$util.getUuid()+".mp3",extends:{duration:e.duration}};this.$emit("send",t)},checkRecorder(e){if(e<1||isNaN(e)||!e)return this.recLength=0,this.tmpVoice="",this.recing=!1,this.isCancel=!0,a({title:"录音时间太短",icon:"error"})},handlerError(e){switch(e){case"101":d({content:"当前浏览器版本较低，请更换浏览器使用，推荐在微信中打开。"});break;case"201":d({content:"麦克风权限被拒绝，请刷新页面后授权麦克风权限。"});break;default:d({content:"录音功能受限，请知晓！"})}}}},[["render",function(e,o,a,n,c,l){const r=i,d=C,S=G(v("mumu-recorder"),Y),U=T,j=M,L=B;return t(),s(r,{id:"more-oprate"},{default:u((()=>[m(r,{class:"im-footer bg-gray",style:x([{paddingBottom:c.paddingB+"px",height:c.footerHeight+"px",bottom:c.InputBottom+"px"}])},{default:u((()=>[m(r,{class:h(["im-menus f-28",[c.recShow?"cuIcon-keyboard":"cuIcon-sound"]]),"hover-class":"tap",onClick:l.showRec},null,8,["class","onClick"]),0==c.recShow?(t(),s(d,{key:0,class:"solid-bottom im-flex1 bg-white im-input",type:"text",modelValue:c.inputMsg,"onUpdate:modelValue":o[0]||(o[0]=e=>c.inputMsg=e),"adjust-position":!1,focus:c.isFocus,maxlength:"300","cursor-spacing":"10",onFocus:l.InputFocus,onBlur:l.InputBlur,onConfirm:l.sendTextMsg,"confirm-type":"send","confirm-hold":!0},null,8,["modelValue","focus","onFocus","onBlur","onConfirm"])):p("",!0),1==c.recShow?(t(),s(r,{key:1,class:"toolBox im-flex1"},{default:u((()=>[m(r,{class:h(["recorder",{active:c.isUseRecorder}]),onTouchstart:g(l.startRecorder,["prevent"]),onTouchend:g(l.endRecorder,["prevent"]),onTouchmove:g(l.moveRecorder,["prevent"]),onTouchcancel:l.cancelRecorder},{default:u((()=>[f(y(c.isUseRecorder?"松开结束":"按住说话"),1)])),_:1},8,["class","onTouchstart","onTouchend","onTouchmove","onTouchcancel"])])),_:1})):p("",!0),c.isH5?(t(),s(S,{key:2,ref:"recorderRef",onSuccess:l.handlerSuccess,onError:l.handlerError},null,8,["onSuccess","onError"])):p("",!0),m(r,{class:"im-flex im-justify-content-start im-align-items-center"},{default:u((()=>[m(r,{class:"im-menus cuIcon-emoji f-28","hover-class":"tap",onClick:o[1]||(o[1]=e=>l.showAppBox(1))}),c.inputMsg?p("",!0):(t(),s(r,{key:0,class:"im-menus cuIcon-roundadd f-28 mr-10","hover-class":"tap",onClick:o[2]||(o[2]=e=>l.showAppBox(2))})),c.inputMsg?(t(),s(r,{key:1},{default:u((()=>[m(U,{class:"cu-btn bg-green shadow mr-10",onClick:l.sendTextMsg},{default:u((()=>[f("发送")])),_:1},8,["onClick"])])),_:1})):p("",!0)])),_:1}),1==c.appBox?(t(),s(r,{key:3,class:"im-flex im-columns im-emoji-box",style:x([{height:c.boxHeight+"px"}])},{default:u((()=>[m(j,{"scroll-x":"",class:"bg-gray nav im-emoji-header","scroll-with-animation":"","scroll-left":c.scrollLeft},{default:u((()=>[(t(!0),_(w,null,k(c.emojiList,((e,i)=>(t(),s(r,{class:h(["cu-item",i==c.TabCur?"text-green":""]),key:i,onClick:l.tabSelect,"data-id":i},{default:u((()=>[m(r,{class:h([[e.icon],"f-20"])},null,8,["class"])])),_:2},1032,["class","onClick","data-id"])))),128))])),_:1},8,["scroll-left"]),m(j,{"scroll-y":"",class:"bg-white im-emoji-body"},{default:u((()=>[m(r,{class:"im-flex im-wrap im-justify-content-start im-align-items-center pd-10"},{default:u((()=>[(t(!0),_(w,null,k(c.currentEmojiList,((e,i)=>(t(),s(r,{class:"im-emoji-item"},{default:u((()=>[m(L,{src:e.src,style:{width:"44rpx"},mode:"widthFix",onClick:t=>l.chooseEmoji(e)},null,8,["src","onClick"])])),_:2},1024)))),256))])),_:1})])),_:1})])),_:1},8,["style"])):p("",!0),2==c.appBox?(t(),s(r,{key:4,class:"im-flex im-app-box im-flex im-justify-content-start im-wrap im-align-content-start pd-20",style:x([{height:c.boxHeight+"px"}])},{default:u((()=>[m(r,{class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:l.chooseImg},{default:u((()=>[m(r,{class:"bg-white cuIcon-album f-24 radius-10 im-app-item-icon"}),m(r,{class:"mt-5"},{default:u((()=>[f("照片")])),_:1})])),_:1},8,["onClick"]),m(r,{class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:l.chooseVideo},{default:u((()=>[m(r,{class:"bg-white cuIcon-video f-24 radius-10 im-app-item-icon"}),m(r,{class:"mt-5"},{default:u((()=>[f("视频")])),_:1})])),_:1},8,["onClick"]),c.isApp?p("",!0):(t(),s(r,{key:0,class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:l.chooseFile},{default:u((()=>[m(r,{class:"bg-white cuIcon-file f-24 radius-10 im-app-item-icon"}),m(r,{class:"mt-5"},{default:u((()=>[f("文件")])),_:1})])),_:1},8,["onClick"])),a.contact.is_group||!c.isH5&&!c.isApp?p("",!0):(t(),s(r,{key:1,class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:o[3]||(o[3]=e=>l.calling(0))},{default:u((()=>[m(r,{class:"bg-white cuIcon-dianhua f-24 radius-10 im-app-item-icon"}),m(r,{class:"mt-5"},{default:u((()=>[f("语音通话")])),_:1})])),_:1})),a.contact.is_group||!c.isH5&&!c.isApp?p("",!0):(t(),s(r,{key:2,class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:o[4]||(o[4]=e=>l.calling(1))},{default:u((()=>[m(r,{class:"bg-white cuIcon-record f-24 radius-10 im-app-item-icon"}),m(r,{class:"mt-5"},{default:u((()=>[f("视频通话")])),_:1})])),_:1})),m(r,{class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:l.chooseProject},{default:u((()=>[m(r,{class:"bg-white cuIcon-apps f-24 radius-10 im-app-item-icon"}),m(r,{class:"mt-5"},{default:u((()=>[f("项目")])),_:1})])),_:1},8,["onClick"]),m(r,{class:"im-flex im-columns im-align-items-center mt-10 im-app-item",onClick:l.chooseProject},{default:u((()=>[m(r,{class:"bg-white cuIcon-friend f-24 radius-10 im-app-item-icon"}),m(r,{class:"mt-5"},{default:u((()=>[f("客户")])),_:1})])),_:1},8,["onClick"])])),_:1},8,["style"])):p("",!0)])),_:1},8,["style"]),b(m(r,{class:"voice-model c-white radius-10 im-flex im-columns im-align-items-center pd-10"},{default:u((()=>[m(r,{class:h(["cuIcon-voicefill mt-15 mb-5 f-28",[c.isCancel?"c-red":""]])},null,8,["class"]),m(r,{class:h([c.isCancel?"c-red":""])},{default:u((()=>[f(y(c.isCancel?"松开取消":"正在录音..."),1)])),_:1},8,["class"])])),_:1},512),[[I,c.isUseRecorder]])])),_:1})}],["__scopeId","data-v-2883fb2d"]]);const Z=e({name:"im-item",components:{},props:{item:{type:Object,default:function(){return{}}},index:{type:Number,default:0},isSelf:{type:Boolean,default:!1}},data:()=>({}),created:function(){},methods:{}},[["render",function(e,o,a,n,c,l){const r=i;return"diy"==a.item.type?(t(),s(r,{key:0,item:a.item,index:a.index,isSelf:a.isSelf},{default:u((()=>[f(" 自定义 ")])),_:1},8,["item","index","isSelf"])):(t(),s(r,{key:1},{default:u((()=>[f(" 暂不支持该消息类型 ")])),_:1}))}]]),ee=S("userInfo");const te=e({name:"im-touch",props:{info:{type:Object,default:function(){return{}}},circleAvatar:{type:Boolean,default:!1}},data:()=>({toucheTimer:0,fingerRes:[],distance:0,taptimer:100}),methods:{openUserInfo(e){e.id!=ee.user_id&&r({url:"/pages/contacts/detail?id="+this.info.id})}}},[["render",function(e,o,a,n,c,l){const r=i;return t(),s(r,{class:"cu-avatar lg radius",onClick:o[0]||(o[0]=e=>l.openUserInfo(a.info)),style:x([{backgroundImage:"url("+a.info.avatar+")"}])},null,8,["style"])}]]),se=U(),ie=j(L),{newMessage:oe,msgList:ae,getContact:ne,appendMsg:ce,checkMsg:le}=R(ie),re=H(L);const de=e({components:{imInput:X,imItem:Z,imUser:te,statusPoint:Q},data:()=>({user:re.userInfo,contact:{},is_group:0,boxStatus:0,paddingT:0,videoUrl:"",videoModel:!1,InputBottom:0,player:null,playIndex:-1,emojiMap:[],fileExt:[],page:1,limit:20,moreData:!0,newMessage:oe,messageList:ae,newheight:0,scrollTop:0,loading:"more",loadLock:!1,scrollHeight:0,paddingB:0,contact_id:0,bottomHeight:50,globalConfig:re.globalConfig,modelName:"",curMsg:""}),computed:{scrollH:function(){let e=E(),t=750/e.windowWidth,s=$(100);this.bottomHeight=s;const i=F().in(this);return setTimeout((()=>{i.select(".cu-header").boundingClientRect(),i.exec((e=>{this.paddingT=e[0].height}))}),10),parseInt((e.windowHeight-this.navBarHeight-this.paddingT)*t)}},watch:{newMessage(e){e.toContactId==this.contact.id&&e.fromUser.id!=this.user.user_id&&this.$api.msgApi.setMsgIsRead({toContactId:this.contact.id,is_group:this.contact.is_group,messages:e,fromUser:e.fromUser.id}),this.scrollToBottom()}},onLoad(e){let t=ie.getContact(e.id);this.contact=t,this.contact_id=e.id,this.is_group=t.is_group,this.getMessageList(),N("updateMessage",(e=>{let t=e.data;switch(e.type){case"isRead":for(let o=0;t.length>o;o++){const e={id:t[o].id,is_read:1};this.updateMessage(e)}break;case"undoMessage":this.updateMessage(t);break;case"simple":case"group":D();let e={},s=location.href;e=this.$util.parseUrl(s);let i=!1;1==t.is_group?t.toUser==e.id&&(i=!0):t.toContactId!=e.id&&t.fromUser.id!=this.user.user_id||(i=!0),i&&(ie.checkMsg(t),ie.appendMsg(t))}}))},onBackPress(e){return this.InputBottom=0,P({url:"/pages/index/index"}),!0},created:function(){let e=[];K.forEach((function(t){let s=t.children;s.length>0&&s.forEach((function(t){let s=t.name,i=t.src;e[s]=i}))})),this.emojiMap=e,se.onPlay((()=>{console.log("play")})),se.onEnded((()=>{console.log("播放完毕，继续播放下一个录音！");var e=Number(this.playIndex);for(let t=e+1;t<this.messageList.length;t++)if("voice"==this.messageList[t].type){this.playNow(this.messageList[t].content,t);break}this.messageList.length<=e+1&&(se.stop(),this.playIndex=-1)})),se.onError((e=>{console.log(e)}))},methods:{getTime:()=>(new Date).getTime(),setPad(e){this.paddingB=e,this.scrollToBottom()},updateMessage(e){let t=this.messageList;t.forEach(((s,i)=>{let o=t[i];s.id==e.id&&(t[i]=Object.assign(o,e))})),this.messageList=t},getScrollHeight(){const e=F().in(this);setTimeout((()=>{e.select(".cu-chat").boundingClientRect(),e.exec((e=>{this.scrollHeight=e[0].height,this.scrollTop=e[0].height-this.newheight,this.loadLock=!1}))}),10)},scrollChat(e){this.newheight=e.detail.scrollHeight,e.detail.scrollTop<10&&0==this.loadLock&&(this.loadLock=!0,this.page++,this.moreData&&(this.loading="loading",setTimeout((()=>{this.getMessageList()}),1e3)))},getMessageList(){this.$api.msgApi.getMessageList({is_group:this.is_group,toContactId:this.contact.id,page:this.page,limit:this.limit}).then((e=>{1==this.page&&(ie.msgList=[]),e.data.slice().reverse().forEach((e=>{ie.msgList.unshift(e)})),this.loading="more",e.data.length<this.limit&&(this.moreData=!1,this.loading="noMore"),this.$nextTick((()=>{1==this.page?this.scrollToBottom():this.getScrollHeight()}))}))},moreOption(e){if(this.getTime()-e.sendTime>12e4)return!1;this.curMsg=e,this.modelName="moreOpt"},undoMsg(){let e=this.curMsg;this.modelName="",this.$api.msgApi.undoMessage({id:e.id}).then((t=>{const s={id:e.id,type:"event",is_undo:1,content:"你撤回了一条消息",oldContent:e.content,toContactId:e.toContactId};this.updateMessage(s)}))},reEdit(e){this.$refs.imInput.inputMsg=e,this.$refs.imInput.isFocus=!0},scrollToBottom(){const e=F().in(this);setTimeout((()=>{e.select(".cu-chat").boundingClientRect(),e.exec((e=>{this.scrollTop=e[0].height+3e3}))}),50)},openDetails(){r({url:"/pages/message/detail?id="+this.contact.id+"&is_group="+this.contact.is_group})},fileSize(e){return this.$util.getFileSize(e)},emojiToHtml(e){let t=this.emojiMap;return e.replace(/\[!(\w+)\]/gi,(function(e,s){var i=s;return t[i]?'<img class=\'mr-5\' style="width:18px;height:18px" emoji-name="'.concat(s,'" src="').concat(t[i],'" />'):"[!".concat(s,"]")}))},sendMessage(e,t){let s=this.user;s.id=s.user_id,e.id=this.$util.getUuid(),e.fromUser=s,e.from_user=this.user.user_id,e.toContactId=this.contact.id,e.is_group=this.contact.is_group,e.sendTime=(new Date).getTime();if("text"==e.type)this.$api.msgApi.sendMessage(e).then((e=>{this.scrollToBottom()})).catch((e=>{401==e.code?a({title:"开启禁言",icon:"none"}):console.log("发送失败",e)}));else if(["image","file","video","voice"].includes(e.type)){if(e.fileSize>1024e4)return a({title:"文件大小不能超过10M",icon:"error"});O({url:this.$api.msgApi.uploadUrl,filePath:e.content,name:"file",header:{authToken:S("authToken")},formData:{message:JSON.stringify(e)},success:e=>{this.scrollToBottom()},fail:e=>{console.log("resres",e)}})}},closeModel(){this.videoUrl="",this.videoModel=!1},handlePlay(e){this.videoUrl=e.content,this.videoModel=!0,se.stop(),this.playIndex=-1},sendTime:function(e){return this.$util.timeFormat(e)},playVoice:function(e){var t=e.currentTarget.dataset.voice,s=e.currentTarget.dataset.index;if(-1==this.playIndex)return this.playNow(t,s);this.playIndex==s?(se.stop(),this.playIndex=-1):(se.stop(),this.playIndex=-1,this.playNow(t,s))},playNow:function(e,t){return this.playIndex=t,se.autoplay=!0,se.src=e,se.play(),!0},showImgs:function(e){for(var t=[],s=e.currentTarget.dataset.img,i=0;i<this.messageList.length;i++)"image"==this.messageList[i].type&&t.push(this.messageList[i].content);z({urls:t,current:s})},closeInput(e){this.boxStatus++}}},[["render",function(e,o,a,n,c,l){const r=A("Tags"),d=A("statusPoint"),g=V,b=i,I=A("cu-custom"),C=G(v("uni-load-more"),q),T=A("im-user"),S=G(v("mp-html"),W),U=B,j=A("imItem"),L=J,R=M,H=A("imInput");return t(),s(b,null,{default:u((()=>[m(I,{bgColor:"bg-white",isBack:!0,class:"cu-header"},{backText:u((()=>[])),content:u((()=>[m(b,{class:"im-flex im-justify-content-center im-align-items-center"},{default:u((()=>[1==c.is_group?(t(),s(r,{key:0,text:"群聊",size:"mini"})):p("",!0),m(g,{class:"text-overflow"},{default:u((()=>[0==c.is_group&&1==c.contact.is_notice&&1==c.globalConfig.chatInfo.online?(t(),s(d,{key:0,type:"success"})):p("",!0),f(y(c.contact.displayName),1)])),_:1})])),_:1})])),right:u((()=>[m(b,{class:"cuIcon-more mr-10 f-16",onClick:l.openDetails},null,8,["onClick"])])),_:1}),m(R,{ref:"scrollView","scroll-y":"true","scroll-anchoring":!0,"scroll-top":c.scrollTop,onScroll:l.scrollChat,style:x({height:l.scrollH+"rpx",position:"fixed",bottom:c.bottomHeight+"px"})},{default:u((()=>[m(b,{class:"cu-chat",style:x({paddingBottom:c.paddingB+"px"}),onClick:l.closeInput,id:"more-oprate"},{default:u((()=>[m(C,{status:c.loading},null,8,["status"]),(t(!0),_(w,null,k(c.messageList,((i,o)=>(t(),_(w,{key:o},["event"==i.type?(t(),s(b,{key:0,class:"cu-info"},{default:u((()=>[f(y(i.content)+" ",1),1==i.is_undo&&l.getTime()-i.sendTime<12e4?(t(),s(g,{key:0,class:"c-primary",onClick:e=>l.reEdit(i.oldContent??"")},{default:u((()=>[f("重新编辑")])),_:2},1032,["onClick"])):p("",!0)])),_:2},1024)):(t(),s(b,{key:1,class:h(["cu-item",[i.fromUser.id==c.user.user_id?"im-rows-reverse self im-justify-content-start":""]])},{default:u((()=>[m(T,{info:i.fromUser},null,8,["info"]),m(b,{class:"main im-wrap",onLongpress:e=>l.moreOption(i)},{default:u((()=>[i.fromUser.id!=c.user.user_id?(t(),s(b,{key:0,class:"f-12 c-666",style:{width:"100%","margin-bottom":"6rpx"}},{default:u((()=>[f(y(i.fromUser.realname),1)])),_:2},1024)):p("",!0),"text"==i.type?(t(),s(b,{key:1,class:h(["content shadow",[i.fromUser.id==c.user.user_id?"bg-green":""]])},{default:u((()=>[m(S,{content:l.emojiToHtml(i.content),class:"im-flex"},null,8,["content"])])),_:2},1032,["class"])):"image"==i.type?(t(),s(U,{key:2,src:i.content,class:"radius",mode:"widthFix",onClick:l.showImgs,"data-img":i.content},null,8,["src","onClick","data-img"])):"voice"==i.type?(t(),s(b,{key:3,class:h(["im-voice-msg im-flex im-rows im-nowrap im-align-items-center radius-20",[o==c.playIndex?"linear-green":"",i.fromUser.id==c.user.user_id?"im-rows-reverse":""]]),"data-voice":i.content,"data-index":o,onClick:l.playVoice,style:x({width:3*i.extends.duration+"px"})},{default:u((()=>[m(g,{class:h(["f-16 cuIcon-subscription rotate45",[o==c.playIndex?"c-white":"",i.fromUser.id==c.user.user_id?"rotate225":""]])},null,8,["class"]),m(g,{class:h(["im-voice-msg-text",[o==c.playIndex?"c-white":""]])},{default:u((()=>[f(y(i.extends.duration)+' "',1)])),_:2},1032,["class"])])),_:2},1032,["class","data-voice","data-index","onClick","style"])):"video"==i.type?(t(),s(b,{key:4},{default:u((()=>[m(b,{class:"course-video radius-10",onClick:e=>l.handlePlay(i)},{default:u((()=>[m(b,{class:"relative-shadow"},{default:u((()=>[m(b,{class:"cuIcon-video icon-center f-28 c-white"})])),_:1}),m(U,{src:i.extends.poster,class:"",mode:"heightFix"},null,8,["src"])])),_:2},1032,["onClick"])])),_:2},1024)):"file"==i.type?(t(),s(b,{key:5},{default:u((()=>[m(b,{class:"file-card bg-white radius-10 im-flex im-justify-content-start pd-10 im-align-items-center",onClick:t=>e.preview(i)},{default:u((()=>[m(b,{class:"file-icon cuIcon-text f-36"}),m(b,{class:"im-flex im-columns ml-10"},{default:u((()=>[m(b,{class:"text-overflow file-name"},{default:u((()=>[f(y(i.fileName),1)])),_:2},1024),m(b,{class:"text-gray file-size f-12"},{default:u((()=>[f(y(l.fileSize(i.fileSize)),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)):(t(),s(j,{key:6,item:i,index:o,isSelf:!0},null,8,["item","index"]))])),_:2},1032,["onLongpress"]),m(b,{class:"date"},{default:u((()=>[0==i.is_group&&i.fromUser.id==c.user.user_id?(t(),s(g,{key:0,class:h(i.is_read?"c-success":"c-gray")},{default:u((()=>[f(y(i.is_read?"已读":"未读"),1)])),_:2},1032,["class"])):p("",!0),f(" "+y(l.sendTime(i.sendTime)),1)])),_:2},1024)])),_:2},1032,["class"]))],64)))),128)),c.videoModel?(t(),s(b,{key:0,class:"video-model im-flex im-align-items-center"},{default:u((()=>[m(b,{class:"c-white radius-16 close-model",onClick:l.closeModel},{default:u((()=>[f("关闭 ")])),_:1},8,["onClick"]),m(L,{class:"video-box",src:c.videoUrl,controls:"",autoplay:"autoplay"},null,8,["src"])])),_:1})):p("",!0)])),_:1},8,["style","onClick"])])),_:1},8,["scroll-top","onScroll","style"]),m(b,{id:"im-input"},{default:u((()=>[m(H,{onSend:l.sendMessage,onSetPad:l.setPad,boxStatus:c.boxStatus,contact:c.contact,ref:"imInput"},null,8,["onSend","onSetPad","boxStatus","contact"])])),_:1}),m(b,{class:h(["cu-modal bottom-modal","moreOpt"==c.modelName?"show":""])},{default:u((()=>[m(b,{class:"cu-dialog"},{default:u((()=>[m(b,{class:"manage-content"},{default:u((()=>[m(b,{class:"cu-list menu bg-white"},{default:u((()=>[l.getTime()-c.curMsg.sendTime<12e4?(t(),s(b,{key:0,class:"cu-item",onClick:o[0]||(o[0]=e=>l.undoMsg())},{default:u((()=>[m(b,{class:"content padding-tb-sm"},{default:u((()=>[m(g,{class:"cuIcon-forward"}),m(g,null,{default:u((()=>[f("撤回消息")])),_:1})])),_:1})])),_:1})):p("",!0),m(b,{class:"parting-line-5"}),m(b,{class:"cu-item",onClick:o[1]||(o[1]=e=>c.modelName="")},{default:u((()=>[m(b,{class:"content padding-tb-sm"},{default:u((()=>[m(g,{class:"c-red"},{default:u((()=>[f("取消")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-dcaae065"]]);export{de as default};
