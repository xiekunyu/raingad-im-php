import{_ as e,x as s,p as a,O as t,q as l,o as r,c as u,w as i,j as c,g as o,i as n,n as d,d as m,e as g,F as h,h as _,t as f,f as p,r as y,k,J as U}from"./index-030df82b.js";const b=s("userInfo");const x=e({data:()=>({keywords:"",group_id:"",modelName:"",userList:[],allUser:[],isAdmin:!1,isManage:!1,isAuth:!1,userInfo:b,curUser:{}}),watch:{keywords(e){""==e?this.userList=this.allUser:this.search()}},onLoad(e){this.group_id=e.group_id?e.group_id:"",this.getGroupuserlist()},methods:{getGroupuserlist(){this.userList=[],this.$api.msgApi.groupUserList({group_id:this.group_id}).then((e=>{const s=e.data.filter((e=>1==e.role&&e.userInfo.id==b.user_id));s.length&&(this.isAdmin=!0);const a=e.data.filter((e=>2==e.role&&e.userInfo.id==b.user_id));a.length&&(this.manage=!0),(s.length||a.length)&&(this.isAuth=!0);const t=e.data;t.forEach((e=>{e.realname=e.userInfo.displayName,e.name_py=e.userInfo.name_py})),this.allUser=t,this.userList=e.data}))},openModel(e){e.realname=e.userInfo.displayName,e.avatar=e.userInfo.avatar,this.curUser=e,this.modelName="userOpt"},setManage(){const e=2==this.curUser.role?3:2;this.$api.msgApi.setManager({id:this.group_id,user_id:this.curUser.user_id,role:e}).then((e=>{0==e.code&&this.getGroupuserlist(),this.modelName=""}))},removeUser(){this.modelName="",a({title:"确定要删除该成员吗?",success:e=>{e.confirm&&this.$api.msgApi.removeUser({id:this.group_id,user_id:this.curUser.user_id}).then((e=>{0==e.code&&this.getGroupuserlist()}))}})},changeOwner(){this.modelName="",a({title:"确定将管理权限转移给该成员吗?",success:e=>{e.confirm&&this.$api.msgApi.changeOwner({id:this.group_id,user_id:this.curUser.user_id}).then((e=>{0==e.code&&t({url:"/pages/mesage/index"})}))}})},search(){const e=JSON.parse(JSON.stringify(this.allUser));this.userList=this.$util.searchObject(e,["realname","name_py"],this.keywords)},openChatDetail(e){b.user_id!=e.user_id&&l({url:"/pages/contacts/detail?id="+e.user_id})}}},[["render",function(e,s,a,t,l,b){const x=y("cu-custom"),I=k,w=U,C=c,N=y("Empty");return r(),u(C,null,{default:i((()=>[o(x,{bgColor:"bg-gradual-green",isBack:!0},{backText:i((()=>[])),content:i((()=>[n("群成员")])),_:1}),o(C,{class:"cu-bar bg-white search fixed",style:d([{top:e.CustomBar+"px"}])},{default:i((()=>[o(C,{class:"search-form round"},{default:i((()=>[o(I,{class:"cuIcon-search"}),o(w,{type:"text",modelValue:l.keywords,"onUpdate:modelValue":s[0]||(s[0]=e=>l.keywords=e),placeholder:"输入搜索的关键词","confirm-type":"search"},null,8,["modelValue"])])),_:1})])),_:1},8,["style"]),o(C,{style:{"margin-top":"104rpx"}},{default:i((()=>[o(C,{class:"cu-list menu-avatar"},{default:i((()=>[(r(!0),m(h,null,g(l.userList,(e=>(r(),u(C,{class:"cu-item"},{default:i((()=>[o(C,{class:"cu-avatar round lg",style:d("background-image:url("+e.userInfo.avatar+");"),onClick:s=>b.openChatDetail(e)},null,8,["style","onClick"]),o(C,{class:"content"},{default:i((()=>[o(C,{class:"text-grey"},{default:i((()=>[o(C,{class:"text-cut"},{default:i((()=>[n(f(e.userInfo.displayName),1)])),_:2},1024),e.role<3?(r(),u(C,{key:0,class:p(["cu-tag round sm",1==e.role?"bg-red":"bg-orange"])},{default:i((()=>[n(f(1==e.role?"群主":2==e.role?"管理员":""),1)])),_:2},1032,["class"])):_("",!0),e.user_id==l.userInfo.user_id?(r(),u(C,{key:1,class:"cu-tag round sm"},{default:i((()=>[n("我")])),_:1})):_("",!0)])),_:2},1024)])),_:2},1024),o(C,{class:"action",onClick:s=>b.openModel(e)},{default:i((()=>[o(C,{class:"text-grey text-sm"},{default:i((()=>[e.role>1&&l.isAuth?(r(),u(I,{key:0,class:"cuIcon-more f-24"})):_("",!0)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),256)),l.userList.length?_("",!0):(r(),u(N,{key:0,noDatatext:"未搜索到数据",textcolor:"#999"}))])),_:1})])),_:1}),o(C,{class:p(["cu-modal bottom-modal","userOpt"==l.modelName?"show":""])},{default:i((()=>[o(C,{class:"cu-dialog"},{default:i((()=>[o(C,{class:"manage-content"},{default:i((()=>[o(C,{class:"cu-list menu bg-white"},{default:i((()=>[l.curUser?(r(),u(C,{key:0,class:"cu-item"},{default:i((()=>[o(C,{class:"content im-flex im-justify-content-center im-align-items-center"},{default:i((()=>[o(C,{class:"cu-avatar round sm",style:d("background-image:url("+l.curUser.avatar+");")},null,8,["style"]),o(C,{class:"text-cut ml-5"},{default:i((()=>[n(f(l.curUser.realname),1)])),_:1}),2==l.curUser.role?(r(),u(C,{key:0,class:"cu-tag round sm bg-orange"},{default:i((()=>[n("管理员")])),_:1})):_("",!0)])),_:1})])),_:1})):_("",!0),l.isAdmin?(r(),u(C,{key:1,class:"cu-item",onClick:s[1]||(s[1]=e=>b.changeOwner())},{default:i((()=>[o(C,{class:"content padding-tb-sm"},{default:i((()=>[o(I,{class:"c-orange"},{default:i((()=>[n("转让管理权限")])),_:1})])),_:1})])),_:1})):_("",!0),l.isAdmin?(r(),u(C,{key:2,class:"cu-item",onClick:s[2]||(s[2]=e=>b.setManage())},{default:i((()=>[o(C,{class:"content padding-tb-sm"},{default:i((()=>[o(I,null,{default:i((()=>[n(f(2==l.curUser.role?"取消管理员":"设为管理员"),1)])),_:1})])),_:1})])),_:1})):_("",!0),o(C,{class:"cu-item",onClick:s[3]||(s[3]=e=>b.removeUser())},{default:i((()=>[o(C,{class:"content padding-tb-sm"},{default:i((()=>[o(I,null,{default:i((()=>[n("移出群聊")])),_:1})])),_:1})])),_:1}),o(C,{class:"parting-line-5"}),o(C,{class:"cu-item",onClick:s[4]||(s[4]=e=>l.modelName="")},{default:i((()=>[o(C,{class:"content padding-tb-sm"},{default:i((()=>[o(I,{class:"c-red"},{default:i((()=>[n("取消")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-62e50c01"]]);export{x as default};
