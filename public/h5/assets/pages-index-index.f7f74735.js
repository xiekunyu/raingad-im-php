import{u as t,s as a,_ as e,a as s,r as l,b as n,o as i,c,w as o,n as u,d,F as r,e as g,f as m,g as f,h as p,i as h,t as _,j as b,k as C,l as x,m as y,p as k,q as T,v as I,x as v,y as w,z as S}from"./index-4eea144c.js";import{s as j,e as P,_ as N}from"./status.76301cbd.js";import{r as M}from"./uni-app.es.b3d97fb4.js";import L from"./pages-contacts-index.e50e00cf.js";const A=t(a);const B=e({name:"message-list",props:{msgs:{type:Array,default:function(){return[]}},btnWidth:{type:Number,default:320}},components:{statusPoint:j},data:()=>({msgsIn:[],damping:.29,moveIndex:-1,x:0,oX:0,scY:!0,btnWidthpx:160,touchStart:!1,modalName:null,listTouchStart:0,listTouchDirection:null,emojiMap:[],chatStatus:!0,paddingB:0,appSetting:A.appSetting,globalConfig:A.globalConfig}),created:function(){this.init(this.msgs),this.btnWidthpx=-1*s(this.btnWidth)+2;let t=[];P.forEach((function(a){let e=a.children;e.length>0&&e.forEach((function(a){let e=a.name,s=a.src;t[e]=s}))})),this.emojiMap=t,this.paddingB=this.inlineTools},watch:{msgs:function(t){this.init(t)}},methods:{init:function(t){this.moveIndex=-1,this.msgsIn=t.filter((t=>t.lastContent))},scrolltolower:function(){},emojiToHtml(t){if(!t)return;let a=this.emojiMap;return t.replace(/\[!(\w+)\]/gi,(function(t,e){var s=e;return a[s]?'<img class=\'mr-5\' style="width:18px;height:18px" emoji-name="'.concat(e,'" src="').concat(a[s],'" />'):"[!".concat(e,"]")}))},ListTouchStart(t){this.listTouchStart=t.touches[0].pageX},ListTouchMove(t){let a=t.touches[0].pageX-this.listTouchStart;Math.abs(a)>100&&a<0?this.listTouchDirection="left":this.listTouchDirection="right"},ListTouchEnd(t){"left"==this.listTouchDirection?(this.modalName=t.currentTarget.dataset.target,this.chatStatus=!1):this.modalName=null,this.listTouchDirection=null},openChat(t,a){this.chatStatus?this.$emit("itemTap",t,a):this.chatStatus=!0},from_time(t){return this.$util.timeFormat(t)},btnTap(t,a){this.$emit("btnTap",t,a)}}},[["render",function(t,a,e,s,x,y){const k=b,T=l("Tags"),I=l("statusPoint"),v=C,w=M(n("mp-html"),N),S=l("Empty");return i(),c(k,{class:"im-message-list"},{default:o((()=>[x.msgsIn.length>0?(i(),c(k,{key:0,class:"cu-list menu-avatar",style:u({paddingBottom:x.paddingB+"px"})},{default:o((()=>[(i(!0),d(r,null,g(x.msgsIn,((t,a)=>(i(),c(k,{class:m(["cu-item",[x.modalName=="move-box-"+a?"move-cur":"",1==t.is_top?"top-contacts":"",0==t.is_group?"third":"second"]]),key:a,onTouchstart:y.ListTouchStart,onTouchmove:y.ListTouchMove,onTouchend:y.ListTouchEnd,onClick:e=>y.openChat(a,t),"data-target":"move-box-"+a},{default:o((()=>[f(k,{class:m(["cu-avatar lg",x.appSetting.circleAvatar?"round":"radius"]),style:u([{backgroundImage:"url("+t.avatar+")"}])},null,8,["class","style"]),f(k,{class:"content"},{default:o((()=>[f(k,{class:"text-grey"},{default:o((()=>[1==t.is_group?(i(),c(T,{key:0,text:"群聊",size:"mini"})):p("",!0),f(k,{class:"text-overflow",style:{width:"80%"}},{default:o((()=>[t.is_online&&0==t.is_group&&1==x.globalConfig.chatInfo.online?(i(),c(I,{key:0,type:"success"})):p("",!0),h(" "+_(t.displayName),1)])),_:2},1024)])),_:2},1024),f(k,{class:"im-flex im-justify-content-start im-align-items-start",style:{height:"50rpx"}},{default:o((()=>[f(k,{class:"text-gray text-sm"},{default:o((()=>[t.unread>0&&0==t.is_notice?(i(),c(v,{key:0},{default:o((()=>[h("["+_(t.unread)+"条未读] ",1)])),_:2},1024)):p("",!0)])),_:2},1024),f(w,{content:y.emojiToHtml(t.lastContent),class:"im-flex text-gray text-sm text-overflow no-click"},null,8,["content"])])),_:2},1024)])),_:2},1024),f(k,{class:"action"},{default:o((()=>[f(k,{class:"text-grey text-xs"},{default:o((()=>[h(_(y.from_time(t.lastSendTime)),1)])),_:2},1024),t.unread>0&&t.is_notice?(i(),c(k,{key:0,class:"cu-tag round bg-red sm"},{default:o((()=>[h(_(t.unread),1)])),_:2},1024)):p("",!0),0==t.is_notice?(i(),c(k,{key:1,class:"c-999"},{default:o((()=>[f(v,{class:"cuIcon-musicforbidfill"})])),_:1})):p("",!0)])),_:2},1024),f(k,{class:m(["move",0==t.is_group?"third":"second"])},{default:o((()=>[1==t.is_top?(i(),c(k,{key:0,class:"bg-grey",onClick:a=>y.btnTap(0,t)},{default:o((()=>[h("取消置顶")])),_:2},1032,["onClick"])):(i(),c(k,{key:1,class:"bg-blue",onClick:a=>y.btnTap(0,t)},{default:o((()=>[h("置顶聊天")])),_:2},1032,["onClick"])),1==t.is_notice?(i(),c(k,{key:2,class:"bg-orange",onClick:a=>y.btnTap(2,t)},{default:o((()=>[h("免扰")])),_:2},1032,["onClick"])):(i(),c(k,{key:3,class:"bg-orange",onClick:a=>y.btnTap(2,t)},{default:o((()=>[h("取消免扰")])),_:2},1032,["onClick"])),0==t.is_group?(i(),c(k,{key:4,class:"bg-red",onClick:a=>y.btnTap(1,t)},{default:o((()=>[h("删除会话")])),_:2},1032,["onClick"])):p("",!0)])),_:2},1032,["class"])])),_:2},1032,["class","onTouchstart","onTouchmove","onTouchend","onClick","data-target"])))),128))])),_:1},8,["style"])):(i(),c(S,{key:1,noDatatext:"暂无聊天",textcolor:"#999"}))])),_:1})}],["__scopeId","data-v-43905a10"]]),$=x(a),{contacts:W}=y($);const D=e({components:{messageList:B},data:()=>({navCurrent:0,msgs:W,mainHeight:500,pageLoading:!0}),methods:{btnTap:function(t,a){0==t?(a.is_top=0==a.is_top?1:0,this.$api.msgApi.setChatTopAPI({id:a.id,is_top:a.is_top,is_group:a.is_group}).then((t=>{0==t.code&&$.updateContacts(a)}))):1==t?k({title:"确定要删除吗?",success:t=>{t.confirm&&this.$api.msgApi.delChatAPI({id:a.id,is_group:a.is_group}).then((t=>{0==t.code&&$.deleteContacts(a)}))}}):2==t&&(a.is_notice=0==a.is_notice?1:0,this.$api.msgApi.setIsNotice({id:a.id,is_notice:a.is_notice,is_group:a.is_group}).then((t=>{0==t.code&&$.updateContacts(a)})))},itemTap:function(t,a){$.unread-=a.unread;let e=this.msgs;e[t].unread=0,$.initContacts(e),T({url:"/pages/message/chat?id="+a.id})}}},[["render",function(t,a,e,s,n,u){const d=l("messageList"),r=b;return i(),c(r,null,{default:o((()=>[f(d,{msgs:n.msgs,onItemTap:u.itemTap,onBtnTap:u.btnTap},null,8,["msgs","onItemTap","onBtnTap"])])),_:1})}],["__scopeId","data-v-1a193281"]]),E=""+new URL("user-card-bg-ba5b09d7.jpg",import.meta.url).href,F=t();const X=e({data:()=>({isCard:!0,userInfo:F.userInfo,paddingB:0}),created:function(){this.paddingB=this.inlineTools},methods:{IsCard(t){this.isCard=t.detail.value}}},[["render",function(t,a,e,s,l,n){const p=I,x=b,y=C;return i(),c(x,{style:u({paddingBottom:l.paddingB+"px"})},{default:o((()=>[f(x,{class:"im-friend-header"},{default:o((()=>[f(x,{class:"im-friend-bg"},{default:o((()=>[f(p,{class:"im-friend-image",src:E,mode:"widthFix"})])),_:1}),f(x,{class:"im-user im-flex im-justify-content-start align-center"},{default:o((()=>[f(y,{class:"text-white mr-5"},{default:o((()=>[h(_(l.userInfo.realname),1)])),_:1}),f(p,{class:"radius-10",style:{width:"120rpx",height:"120rpx"},src:l.userInfo.avatar,mode:"widthFix"},null,8,["src"])])),_:1})])),_:1}),f(x,{class:"cu-card dynamic no-card"},{default:o((()=>[f(x,{class:"cu-item shadow"},{default:o((()=>[f(x,{class:"cu-list menu-avatar"},{default:o((()=>[f(x,{class:"cu-item"},{default:o((()=>[f(x,{class:"cu-avatar round lg",style:{"background-image":"url(https://api.multiavatar.com/raingad3.png?apikey=zdvXV3W4MjwhP9)"}}),f(x,{class:"content flex-sub"},{default:o((()=>[f(x,null,{default:o((()=>[h("凯尔")])),_:1}),f(x,{class:"text-gray text-sm flex justify-between"},{default:o((()=>[h(" 2019年12月3日 ")])),_:1})])),_:1})])),_:1})])),_:1}),f(x,{class:"text-content"},{default:o((()=>[h(" 折磨生出苦难，苦难又会加剧折磨，凡间这无穷的循环，将有我来终结！ ")])),_:1}),f(x,{class:m(["grid flex-sub padding-lr",l.isCard?"col-3 grid-square":"col-1"])},{default:o((()=>[(i(!0),d(r,null,g(l.isCard?9:1,((t,a)=>(i(),c(x,{class:m(["bg-img",l.isCard?"":"only-img"]),style:{"background-image":"url(https://ossweb-img.qq.com/images/lol/web201310/skin/big10006.jpg)"},key:a},null,8,["class"])))),128))])),_:1},8,["class"]),f(x,{class:"text-gray text-sm text-right padding"},{default:o((()=>[f(y,{class:"cuIcon-attentionfill margin-lr-xs"}),h(" 10 "),f(y,{class:"cuIcon-appreciatefill margin-lr-xs"}),h(" 20 "),f(y,{class:"cuIcon-messagefill margin-lr-xs"}),h(" 30 ")])),_:1}),f(x,{class:"cu-list menu-avatar comment solids-top"},{default:o((()=>[f(x,{class:"cu-item"},{default:o((()=>[f(x,{class:"cu-avatar round",style:{"background-image":"url(https://api.multiavatar.com/raingad5.png?apikey=zdvXV3W4MjwhP9)"}}),f(x,{class:"content"},{default:o((()=>[f(x,{class:"text-grey"},{default:o((()=>[h("莫甘娜")])),_:1}),f(x,{class:"text-gray text-content text-df"},{default:o((()=>[h(" 凯尔，你被自己的光芒变的盲目。 ")])),_:1}),f(x,{class:"bg-grey padding-sm radius margin-top-sm text-sm"},{default:o((()=>[f(x,{class:"flex"},{default:o((()=>[f(x,null,{default:o((()=>[h("凯尔：")])),_:1}),f(x,{class:"flex-sub"},{default:o((()=>[h("妹妹，你在帮他们给黑暗找借口吗?")])),_:1})])),_:1})])),_:1}),f(x,{class:"margin-top-sm flex justify-between"},{default:o((()=>[f(x,{class:"text-gray text-df"},{default:o((()=>[h("2018年12月4日")])),_:1}),f(x,null,{default:o((()=>[f(y,{class:"cuIcon-appreciatefill text-red"}),f(y,{class:"cuIcon-messagefill text-gray margin-left-sm"})])),_:1})])),_:1})])),_:1})])),_:1}),f(x,{class:"cu-item"},{default:o((()=>[f(x,{class:"cu-avatar round",style:{"background-image":"url(https://api.multiavatar.com/raingad2.png?apikey=zdvXV3W4MjwhP9)"}}),f(x,{class:"content"},{default:o((()=>[f(x,{class:"text-grey"},{default:o((()=>[h("凯尔")])),_:1}),f(x,{class:"text-gray text-content text-df"},{default:o((()=>[h(" 妹妹，如果不是为了飞翔，我们要这翅膀有什么用? ")])),_:1}),f(x,{class:"bg-grey padding-sm radius margin-top-sm text-sm"},{default:o((()=>[f(x,{class:"flex"},{default:o((()=>[f(x,null,{default:o((()=>[h("莫甘娜：")])),_:1}),f(x,{class:"flex-sub"},{default:o((()=>[h("如果不能立足于大地，要这双脚又有何用?")])),_:1})])),_:1})])),_:1}),f(x,{class:"margin-top-sm flex justify-between"},{default:o((()=>[f(x,{class:"text-gray text-df"},{default:o((()=>[h("2018年12月4日")])),_:1}),f(x,null,{default:o((()=>[f(y,{class:"cuIcon-appreciate text-gray"}),f(y,{class:"cuIcon-messagefill text-gray margin-left-sm"})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["style"])}],["__scopeId","data-v-2da58bb3"]]),z=t(a);const q=e({data:()=>({loginStore:z,globalConfig:z.globalConfig,appSetting:z.appSetting}),onShow(){},methods:{logout(){let t=v("client_id");this.$api.LoginApi.logout({client_id:t}).then((t=>{0==t.code&&z.logout()}))},about(){if(this.globalConfig&&!this.globalConfig.demon_mode){T({url:"/pages/mine/webview?src="+"https://im.raingad.com"})}else T({url:"/pages/mine/about"})},showSetting(){T({url:"/pages/mine/setting"})},showsecure(){T({url:"/pages/mine/secure"})},editInfo(){T({url:"/pages/mine/profile"})},setAvatar(){T({url:"/pages/mine/avatar"})}}},[["render",function(t,a,e,s,l,n){const d=b,r=C,g=w;return i(),c(d,null,{default:o((()=>[f(d,{class:"padding flex justify-start bg-white mb-10"},{default:o((()=>[f(d,{class:m(["cu-avatar lg mr-15",l.appSetting.circleAvatar?"round":"radius"]),onClick:n.setAvatar,style:u([{backgroundImage:"url("+l.loginStore.userInfo.avatar+")"}])},null,8,["class","onClick","style"]),f(d,{class:"im-flex im-justify-content-start im-columns",onClick:a[0]||(a[0]=t=>n.editInfo())},{default:o((()=>[f(d,{class:"mb-5 f-18 mb-10"},{default:o((()=>[h(_(l.loginStore.userInfo.realname),1)])),_:1}),f(d,{class:"text-gray mb-10"},{default:o((()=>[h(_(l.loginStore.userInfo.account),1)])),_:1})])),_:1})])),_:1}),f(d,{class:"cu-list menu"},{default:o((()=>[f(d,{class:"cu-item",onClick:n.showSetting},{default:o((()=>[f(d,{class:"content"},{default:o((()=>[f(r,{class:"cuIcon-settings text-grey"}),f(r,null,{default:o((()=>[h("通用设置")])),_:1})])),_:1}),f(d,{class:"action"},{default:o((()=>[f(r,{class:"text-grey cuIcon-right"})])),_:1})])),_:1},8,["onClick"]),f(d,{class:"cu-item",onClick:n.showsecure},{default:o((()=>[f(d,{class:"content"},{default:o((()=>[f(r,{class:"cuIcon-lock text-orange"}),f(r,null,{default:o((()=>[h("账号安全")])),_:1})])),_:1}),f(d,{class:"action"},{default:o((()=>[f(r,{class:"text-grey cuIcon-right"})])),_:1})])),_:1},8,["onClick"]),f(d,{class:"cu-item",onClick:a[1]||(a[1]=t=>n.about())},{default:o((()=>[f(d,{class:"content"},{default:o((()=>[f(r,{class:"cuIcon-info text-green"}),f(r,null,{default:o((()=>[h("关于IM")])),_:1})])),_:1}),f(d,{class:"action"},{default:o((()=>[f(r,{class:"text-grey cuIcon-right"})])),_:1})])),_:1})])),_:1}),f(d,{class:"padding flex flex-direction"},{default:o((()=>[f(g,{class:"cu-btn bg-red lg",onClick:a[2]||(a[2]=t=>n.logout())},{default:o((()=>[h("退出登录")])),_:1})])),_:1})])),_:1})}]]),G=x(a),H=t(a),{unread:U,sysUnread:V}=y(G);const R=e({components:{message:D,contacts:L,compass:X,mine:q},data:()=>({globalConfig:H.globalConfig,PageCur:"message",PageName:"消息",TabCur:0,modelName:!1,navList:[{name:"message",title:"消息",notice:U},{name:"contacts",title:"通讯录",notice:V},{name:"compass",title:"探索",notice:0},{name:"mine",title:"我的",notice:0}]}),onShow(){},mounted(){S(),this.initContacts()},methods:{openModel(t){this.modelName=t},closeModel(){this.modelName=!1},NavChange:function(t){this.PageCur=t.name,this.PageName=t.title},showContacts(){1==this.TabCur?this.TabCur=0:this.TabCur=1},initContacts(){this.$api.msgApi.initContacts().then((t=>{let a=[],e=0;this.allMsg=t.data,t.data.forEach((t=>{t.lastContent&&(e+=t.unread),a.push(t)})),G.sysUnread=t.count,G.unread=e,G.initContacts(a)}))},addGroup(){T({url:"/pages/message/group/addGroup?type=1"})},addFriend(){T({url:"/pages/contacts/search"})},addNew(){1==this.globalConfig.sysInfo.runMode?this.addGroup():this.openModel("add")},search(){const t="message"==this.PageCur?1:2;T({url:"/pages/index/search?type="+t})}}},[["render",function(t,a,e,s,n,u){const x=C,y=b,k=l("cu-custom"),T=l("message"),v=l("contacts"),w=l("compass"),S=l("mine"),j=I;return i(),c(y,null,{default:o((()=>[f(k,{bgColor:"bg-white"},{backText:o((()=>["message"==n.PageCur||"contacts"==n.PageCur?(i(),c(y,{key:0,class:"f-20 ml-10 mr-10",onClick:a[0]||(a[0]=t=>u.search())},{default:o((()=>[f(x,{class:"cuIcon-search",style:{"margin-left":"-10px"}})])),_:1})):p("",!0)])),content:o((()=>[h(_(n.PageName),1)])),right:o((()=>["contacts"==n.PageCur&&n.globalConfig&&n.globalConfig.demon_mode?(i(),c(y,{key:0,class:"f-20 ml-10 mr-10",onClick:a[1]||(a[1]=t=>u.showContacts())},{default:o((()=>[f(x,{class:m(["f-24",n.TabCur?"cuIcon-peoplelist":"cuIcon-friend"])},null,8,["class"])])),_:1})):p("",!0),"message"==n.PageCur?(i(),c(y,{key:1,class:"f-20 ml-10 mr-10",onClick:a[2]||(a[2]=t=>u.addNew())},{default:o((()=>[f(x,{class:"cuIcon-add f-28"})])),_:1})):p("",!0)])),_:1}),f(y,null,{default:o((()=>["message"==n.PageCur?(i(),c(T,{key:0})):p("",!0),"contacts"==n.PageCur?(i(),c(v,{key:1,TabCur:n.TabCur},null,8,["TabCur"])):p("",!0),"compass"==n.PageCur?(i(),c(w,{key:2})):p("",!0),"mine"==n.PageCur?(i(),c(S,{key:3})):p("",!0)])),_:1}),f(y,{class:"cu-bar tabbar bg-white shadow foot"},{default:o((()=>[(i(!0),d(r,null,g(n.navList,((t,a)=>(i(),c(y,{class:"action",onClick:a=>u.NavChange(t),key:a,"data-cur":"message"},{default:o((()=>[f(y,{class:"cuIcon-cu-image"},{default:o((()=>[f(j,{src:"/static/image/tabbar/"+[t.name]+[n.PageCur==t.name?"-active":""]+".svg"},null,8,["src"]),t.notice>0?(i(),c(y,{key:0,class:"cu-tag badge"},{default:o((()=>[h(_(t.notice),1)])),_:2},1024)):p("",!0)])),_:2},1024),f(y,{class:m(n.PageCur==t.name?"text-green":"text-black")},{default:o((()=>[h(_(t.title),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1}),f(y,{class:m(["cu-modal bottom-modal","add"==n.modelName?"show":""]),onClick:a[6]||(a[6]=t=>n.modelName="")},{default:o((()=>[f(y,{class:"cu-dialog"},{default:o((()=>[f(y,{class:"manage-content"},{default:o((()=>[f(y,{class:"cu-list menu bg-white"},{default:o((()=>[f(y,{class:"cu-item",onClick:a[3]||(a[3]=t=>u.addFriend())},{default:o((()=>[f(y,{class:"content padding-tb-sm"},{default:o((()=>[f(x,{class:"cuIcon-friendadd"}),f(x,null,{default:o((()=>[h("添加朋友")])),_:1})])),_:1})])),_:1}),f(y,{class:"cu-item",onClick:a[4]||(a[4]=t=>u.addGroup())},{default:o((()=>[f(y,{class:"content padding-tb-sm"},{default:o((()=>[f(x,{class:"cuIcon-friend"}),f(x,null,{default:o((()=>[h("创建群聊")])),_:1})])),_:1})])),_:1}),f(y,{class:"parting-line-5"}),f(y,{class:"cu-item",onClick:a[5]||(a[5]=t=>n.modelName="")},{default:o((()=>[f(y,{class:"content padding-tb-sm"},{default:o((()=>[f(x,{class:"c-red"},{default:o((()=>[h("取消")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}]]);export{R as default};
