"use strict";(self["webpackChunkRaingad_IM"]=self["webpackChunkRaingad_IM"]||[]).push([[982],{7076:function(e,t,a){a.d(t,{Z:function(){return u}});var s=function(){var e=this,t=e._self._c;return t("div",[t("el-container",[t("el-aside",{attrs:{width:"320px"}},[t("div",{staticClass:"lz-flex group-box"},[e.showSearch?t("div",{staticClass:"group-box-header"},[t("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入关键字搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChange.apply(null,arguments)}},model:{value:e.params.keywords,callback:function(t){e.$set(e.params,"keywords",t)},expression:"params.keywords"}},[t("el-button",{attrs:{slot:"prepend",icon:"el-icon-back"},on:{click:function(t){e.showSearch=!1}},slot:"prepend"}),t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleChange},slot:"append"})],1)],1):t("div",{staticClass:"group-box-header"},[t("div",[t("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:function(t){return e.chooseTab(1)}}},[e._v("TA的会话")]),t("el-button",{staticClass:"ml-10",attrs:{type:"success",size:"small",plain:""},on:{click:function(t){return e.chooseTab(0)}}},[e._v("TA的联系人")])],1),t("div",[t("el-button",{attrs:{plain:"",circle:"",icon:"el-icon-search",title:"搜索"},on:{click:function(t){e.showSearch=!0}}})],1)]),t("div",{staticClass:"group-box-list"},[t("el-scrollbar",e._l(e.list,(function(a){return t("div",{key:a.user_id,staticClass:"chat-item",class:e.active==a.user_id?"active":"",on:{click:function(t){return e.openChat(a)}}},[t("div",{staticClass:"chat-avatar"},[t("img",{attrs:{src:a.avatar,alt:"avatar"}})]),t("div",{staticClass:"chat-content"},[t("span",{staticClass:"chat-name"},[e._v(e._s(a.realname))])])])})),0)],1),t("div",{staticClass:"group-box-page",attrs:{align:"center"}},[t("el-pagination",{attrs:{background:"",total:e.total,"current-page":e.params.page,"page-size":e.params.limit,layout:"total, prev, next , jumper"},on:{"current-change":e.getList,"update:currentPage":function(t){return e.$set(e.params,"page",t)},"update:current-page":function(t){return e.$set(e.params,"page",t)},"update:pageSize":function(t){return e.$set(e.params,"limit",t)},"update:page-size":function(t){return e.$set(e.params,"limit",t)}}})],1)])]),t("el-main",{staticStyle:{padding:"0"}},[t("div",{staticClass:"lz-flex group-box group-user-box"},[t("div",{staticClass:"group-box-header"},[t("div",[e._v("聊天记录")])]),t("div",{staticClass:"group-box-list",staticStyle:{padding:"15px"}},[e.currentChat.user_id?t("ChatRecord",{key:e.componentKey,attrs:{contact:e.currentChat,condition:e.condition,manage:!0}}):e._e()],1)])])],1)],1)},n=[],r=a(284),i=a(8100),o=(a(2325),{components:{Group:r.Z,ChatRecord:i.Z},props:{userInfo:{type:Object,default:{}}},data(){return{componentKey:99,messageBox:!1,isAdd:!0,dialogTitle:"创建群聊",createChatBox:!1,userIds:[],showSearch:!1,value:!1,active:0,currentChat:{},params:{hasConvo:1,user_id:0,page:1,limit:20,keywords:""},total:0,list:[],condition:{}}},created(){this.getList()},methods:{openChat(e){this.active=e.user_id,this.currentChat=e,this.componentKey++,this.condition={user_id:this.userInfo.user_id}},chooseTab(e){this.params.page=1,this.params.hasConvo=e,this.getList()},getList(){this.params.user_id=this.userInfo.user_id,this.$api.messageApi.getContacts(this.params).then((e=>{0==e.code&&(this.list=e.data,this.total=e.count,this.params.page=e.page)}))},handleChange(){this.params.page=1,this.getList()}}}),l=o,c=a(1001),p=(0,c.Z)(l,s,n,!1,null,"61b0eeda",null),u=p.exports},196:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"m-20"},[t("div",{staticClass:"mb-15 lz-flex lz-space-between"},[t("div",[t("el-radio-group",{on:{input:function(t){return e.handleChange()}},model:{value:e.params.type,callback:function(t){e.$set(e.params,"type",t)},expression:"params.type"}},e._l(e.typeList,(function(a,s){return t("el-radio-button",{key:s,attrs:{label:a.value}},[e._v(e._s(a.name))])})),1),t("el-radio-group",{staticClass:"ml-10",on:{input:function(t){return e.handleChange()}},model:{value:e.params.is_group,callback:function(t){e.$set(e.params,"is_group",t)},expression:"params.is_group"}},[t("el-radio-button",{attrs:{label:-1}},[e._v("全部")]),t("el-radio-button",{attrs:{label:1}},[e._v("单聊")]),t("el-radio-button",{attrs:{label:2}},[e._v("群聊")])],1)],1),t("div",[t("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入关键字搜索","prefix-icon":"el-icon-search"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleChange.apply(null,arguments)}},model:{value:e.params.keywords,callback:function(t){e.$set(e.params,"keywords",t)},expression:"params.keywords"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.handleChange},slot:"append"})],1)],1)]),t("el-table",{staticStyle:{width:"100%",border:"solid 1px #e3e3e3"},attrs:{data:e.list,stripe:"",height:"calc(100vh - 200px)","header-cell-style":{"background-color":"#f5f7fa",color:"#909399"}},on:{"sort-change":e.sortChange,"row-dblclick":e.handleClick}},[t("el-table-column",{attrs:{fixed:"",prop:"msg_id",label:"ID",sortable:"custom",width:"80"}}),t("el-table-column",{attrs:{prop:"id",label:"消息ID",width:"280"}}),t("el-table-column",{attrs:{prop:"type",label:"类型",width:"80"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticClass:"el-dropdown-link"},[e._v(e._s(e.getMsgType(a.row.type)))])]}}])}),t("el-table-column",{attrs:{prop:"role",label:"内容","min-width":"300"},scopedSlots:e._u([{key:"default",fn:function(a){return[["text","location","contact"].includes(a.row.type)?t("div",{domProps:{innerHTML:e._s(a.row.content)}}):["image"].includes(a.row.type)?t("div",{staticClass:"cur-handle",on:{click:function(t){return e.preview(a.row)}}},[t("el-image",{staticStyle:{height:"80px"},attrs:{src:a.row.content,fit:"contain"}})],1):["video","voice","file"].includes(a.row.type)?t("div",{on:{click:function(t){return e.preview(a.row)}}},[t("el-link",{staticClass:"mr-10",attrs:{type:"primary"}},[e._v("预览")]),t("span",[e._v(e._s(a.row.fileName??"未知"))])],1):t("div",[e._v("暂不支持消息")])]}}])}),t("el-table-column",{attrs:{prop:"create_time",label:"发送时间",sortable:"custom",width:"140"}}),t("el-table-column",{attrs:{prop:"from_user",label:"发送对象",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-link",{attrs:{type:"primary"},on:{click:function(t){return e.openChat(a.row.fromUser)}}},[e._v(e._s(a.row.fromUser.realname))])]}}])}),t("el-table-column",{attrs:{prop:"to_user",label:"接收对象",width:"120"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",[a.row.is_group?t("span",[e._v("[群聊] ")]):e._e(),e._v(" "+e._s(a.row.toUser&&a.row.toUser.name))])]}}])}),t("el-table-column",{attrs:{fixed:"right",label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popconfirm",{attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"确定屏蔽这条内容吗？"},on:{confirm:function(t){return e.deal(a.row,0)}}},[t("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[t("span",{staticClass:"c-orange"},[e._v("屏蔽")])])],1),t("el-popconfirm",{staticClass:"ml-10",attrs:{"confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"确定删除这条内容吗？"},on:{confirm:function(t){return e.deal(a.row,1)}}},[t("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[t("span",{staticClass:"c-red"},[e._v("删除")])])],1)]}}])})],1),t("div",{staticClass:"mt-15"},[t("el-pagination",{attrs:{background:"","current-page":e.params.page,"page-sizes":[20,50,100,200,300,400,500],"page-size":e.params.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleChange,"current-change":e.getList,"update:currentPage":function(t){return e.$set(e.params,"page",t)},"update:current-page":function(t){return e.$set(e.params,"page",t)},"update:pageSize":function(t){return e.$set(e.params,"limit",t)},"update:page-size":function(t){return e.$set(e.params,"limit",t)}}})],1),t("el-dialog",{attrs:{title:e.currentUser.realname+" 的会话列表",visible:e.dialogueBox,modal:!0,width:"80%","append-to-body":""},on:{"update:visible":function(t){e.dialogueBox=t},close:function(t){e.dialogueBox=!1}}},[t("dialogue",{key:e.componentKey,attrs:{userInfo:e.currentUser}})],1)],1)},n=[],r=a(3822),i=a(6647),o=a(7076),l=a(2325),c={components:{userSelect:i.Z,dialogue:o.Z},data(){return{total:0,params:{type:"all",is_group:-1,page:1,limit:20,keywords:"",order_field:"",order_type:1},componentKey:11,list:[],dialogueBox:!1,currentUser:{},typeList:[{name:"全部",value:"all"},{name:"文本",value:"text"},{name:"图片",value:"image"},{name:"音频",value:"voice"},{name:"视频",value:"video"},{name:"文件",value:"file"}]}},computed:{...(0,r.rn)({globalConfig:e=>e.globalConfig})},watch:{},mounted(){this.getList()},methods:{getList(){this.$api.messageApi.getMessageList(this.params).then((e=>{0==e.code&&(this.list=e.data,this.total=e.count,this.params.page=e.page)}))},getMsgType(e){return l.nZ(e)},sortChange(e){this.params.order_field=e.prop,null==e.order&&(this.params.order_field=null),this.params.order_type="ascending"==e.order?1:2,this.getList()},handleClick(e){},openChat(e){this.componentKey++,this.currentUser=e,this.dialogueBox=!0},handleChange(){this.params.page=1,this.getList()},deal(e,t){this.$api.messageApi.dealMsg({id:e.id,dealType:t}).then((e=>{0==e.code&&this.getList()}))},preview(e){this.$preview(e.preview)}}},p=c,u=a(1001),d=(0,u.Z)(p,s,n,!1,null,"0e963288",null),h=d.exports}}]);